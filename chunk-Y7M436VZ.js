import{a as Ye,b as Je,c as et,d as tt,e as it}from"./chunk-YTIG7DF5.js";import{$a as S,A as I,Ab as N,B as C,Bb as Ve,C as P,Ca as R,Cb as ze,Da as te,Db as Be,Ea as ke,F as ee,G as _,J as Ce,M as $,Md as Ze,N as g,Na as Re,Od as Qe,Pa as X,Qa as Ae,Qc as je,R as De,Ra as ce,Sa as ue,T as V,Tc as q,U as Ee,Uc as Ge,V as Te,Wa as A,Wc as $e,Y as Fe,Za as z,_ as Ue,ab as me,ba as D,c as le,ca as E,ed as Xe,fa as Me,fd as qe,ga as Ie,gd as Ke,ha as f,hb as ie,hd as We,i as xe,ia as l,ja as u,jb as B,ka as v,l as G,mb as Ne,nb as Oe,pa as L,pb as He,qb as Pe,ra as x,sa as y,u as H,v as Se,wa as de,xa as Le,y as p,yb as T,z as M,zb as pe}from"./chunk-7K7CQNZ2.js";import{a as k,b as j,e as gt,f as ht}from"./chunk-M4OEJGNZ.js";var lt=gt((ve,be)=>{"use strict";(function(i,c){typeof define=="function"&&define.amd?define([],c):typeof ve<"u"?c():(c(),i.FileSaver={})})(ve,function(){"use strict";function i(o,r){return typeof r>"u"?r={autoBom:!1}:typeof r!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),r={autoBom:!r}),r.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(o.type)?new Blob(["\uFEFF",o],{type:o.type}):o}function c(o,r,h){var d=new XMLHttpRequest;d.open("GET",o),d.responseType="blob",d.onload=function(){s(d.response,r,h)},d.onerror=function(){console.error("could not download file")},d.send()}function t(o){var r=new XMLHttpRequest;r.open("HEAD",o,!1);try{r.send()}catch{}return 200<=r.status&&299>=r.status}function e(o){try{o.dispatchEvent(new MouseEvent("click"))}catch{var r=document.createEvent("MouseEvents");r.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),o.dispatchEvent(r)}}var n=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof global=="object"&&global.global===global?global:void 0,a=n.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),s=n.saveAs||(typeof window!="object"||window!==n?function(){}:"download"in HTMLAnchorElement.prototype&&!a?function(o,r,h){var d=n.URL||n.webkitURL,b=document.createElement("a");r=r||o.name||"download",b.download=r,b.rel="noopener",typeof o=="string"?(b.href=o,b.origin===location.origin?e(b):t(b.href)?c(o,r,h):e(b,b.target="_blank")):(b.href=d.createObjectURL(o),setTimeout(function(){d.revokeObjectURL(b.href)},4e4),setTimeout(function(){e(b)},0))}:"msSaveOrOpenBlob"in navigator?function(o,r,h){if(r=r||o.name||"download",typeof o!="string")navigator.msSaveOrOpenBlob(i(o,h),r);else if(t(o))c(o,r,h);else{var d=document.createElement("a");d.href=o,d.target="_blank",setTimeout(function(){e(d)})}}:function(o,r,h,d){if(d=d||open("","_blank"),d&&(d.document.title=d.document.body.innerText="downloading..."),typeof o=="string")return c(o,r,h);var b=o.type==="application/octet-stream",m=/constructor/i.test(n.HTMLElement)||n.safari,F=/CriOS\/[\d]+/.test(navigator.userAgent);if((F||b&&m||a)&&typeof FileReader<"u"){var O=new FileReader;O.onloadend=function(){var U=O.result;U=F?U:U.replace(/^data:[^;]*;/,"data:attachment/file;"),d?d.location.href=U:location=U,d=null},O.readAsDataURL(o)}else{var Y=n.URL||n.webkitURL,w=Y.createObjectURL(o);d?d.location=w:location.href=w,d=null,setTimeout(function(){Y.revokeObjectURL(w)},4e4)}});n.saveAs=s.saveAs=s,typeof be<"u"&&(be.exports=s)})});var ge={strings:{},pluralize(i){return i===1?0:1}};ge.strings={addBulkFilesFailed:{0:"Das Hinzuf\xFCgen einer Datei ist aufgrund eines internen Fehlers fehlgeschlagen",1:"Das Hinzuf\xFCgen von %{smart_count} Dateien ist aufgrund eines internen Fehlers fehlgeschlagen"},addingMoreFiles:"Dateien hinzuf\xFCgen",addMore:"Mehr hinzuf\xFCgen",addMoreFiles:"Dateien hinzuf\xFCgen",allFilesFromFolderNamed:"Alle Dateien vom Ordner %{name}",allowAccessDescription:"Um Bilder oder Videos mit Ihrer Kamera aufzunehmen, erlauben Sie dieser Website bitte den Zugriff auf Ihre Kamera.",allowAccessTitle:"Bitte erlauben Sie Zugriff auf Ihre Kamera",aspectRatioLandscape:"Zuschneiden auf Querformat (16:9)",aspectRatioPortrait:"Zuschneiden auf Hochformat (9:16)",aspectRatioSquare:"Zuschneiden auf Quadrat",authenticateWith:"Mit %{pluginName} verbinden",authenticateWithTitle:"Bitte authentifizieren Sie sich mit %{pluginName}, um Dateien auszuw\xE4hlen",back:"Zur\xFCck",backToSearch:"Zur\xFCck zur Suche",browse:"durchsuchen",browseFiles:"Dateien durchsuchen",browseFolders:"Ordner durchsuchen",cancel:"Abbrechen",cancelUpload:"Hochladen abbrechen",closeModal:"Fenster schlie\xDFen",companionError:"Verbindung zu Companion fehlgeschlagen",companionUnauthorizeHint:"Um die Autorisierung f\xFCr Ihr %{provider} Konto aufzuheben, gehen Sie bitte zu %{url}",complete:"Fertig",connectedToInternet:"Mit dem Internet verbunden",copyLink:"Link kopieren",copyLinkToClipboardFallback:"Untenstehende URL kopieren",copyLinkToClipboardSuccess:"Link in die Zwischenablage kopiert",creatingAssembly:"Das Hochladen wird vorbereiten...",creatingAssemblyFailed:"Transloadit: Assembly konnte nicht erstellt werden",dashboardTitle:"Hochladen von Dateien",dashboardWindowTitle:"Hochladen von Dateien (ESC dr\xFCcken zum Schlie\xDFen)",dataUploadedOfTotal:"%{complete} von %{total}",discardRecordedFile:"Aufgenommene Datei verwerfen",done:"Abgeschlossen",dropHint:"Dateien hier ablegen",dropPasteBoth:"Dateien hier ablegen/einf\xFCgen, %{browseFiles} oder %{browseFolders}",dropPasteFiles:"Dateien hier ablegen/einf\xFCgen oder %{browseFiles}",dropPasteFolders:"Dateien hier ablegen/einf\xFCgen oder %{browseFolders}",dropPasteImportBoth:"Dateien hier ablegen/einf\xFCgen, %{browse} oder von folgenden Quellen importieren:",dropPasteImportFiles:"Dateien hier ablegen/einf\xFCgen, %{browseFiles} oder von folgenden Quellen importieren:",dropPasteImportFolders:"Dateien hier ablegen/einf\xFCgen, %{browseFolders} oder von folgenden Quellen importieren:",editFile:"Datei bearbeiten",editImage:"Bild bearbeiten",editFileWithFilename:"Datei %{file} bearbeiten",editing:"%{file} bearbeiten",emptyFolderAdded:"Keine Dateien hinzugef\xFCgt, da der Ordner leer war",encoding:"Kodieren...",enterCorrectUrl:"Falsche URL: Bitte stellen Sie sicher, dass Sie einen direkten Link zu einer Datei eingeben",enterTextToSearch:"Text zum Suchen von Bildern eingeben",enterUrlToImport:"URL zum Importieren einer Datei eingeben",exceedsSize:"Datei %{file} ist gr\xF6\xDFer als die maximal erlaubte Dateigr\xF6\xDFe von %{size}",failedToFetch:"Companion konnte diese URL nicht verarbeiten - stellen Sie bitte sicher, dass sie korrekt ist",failedToUpload:"Fehler beim Hochladen der Datei %{file}",filesUploadedOfTotal:{0:"%{complete} von %{smart_count} Datei hochgeladen",1:"%{complete} von %{smart_count} Dateien hochgeladen"},filter:"Filter",finishEditingFile:"Bearbeitung beenden",flipHorizontal:"Horizontal spiegeln",folderAdded:{0:"Eine Datei von %{folder} hinzugef\xFCgt",1:"%{smart_count} Dateien von %{folder} hinzugef\xFCgt"},folderAlreadyAdded:'Der Ordner "%{folder}" wurde bereits hinzugef\xFCgt',generatingThumbnails:"Erstellen von Miniaturansichten...",import:"Importieren",importFiles:"Importiere Dateien von:",importFrom:"Importieren von %{name}",inferiorSize:"Diese Datei ist kleiner als die minimal erlaubte Dateigr\xF6\xDFe von %{size}",loading:"Laden...",logOut:"Abmelden",micDisabled:"Zugriff auf Mikrofon von Benutzer abgelehnt",missingRequiredMetaField:"Fehlende erforderliche Meta-Felder",missingRequiredMetaFieldOnFile:"Fehlende erforderliche Meta-Felder in %{fileName}",missingRequiredMetaFields:{0:"Fehlendes erforderliches Meta-Feld: %{fields}.",1:"Fehlende erforderliche Meta-Felder: %{fields}."},myDevice:"Mein Ger\xE4t",noCameraDescription:"Bitte Kamera anschlie\xDFen, um Bilder oder Videos aufzunehmen",noCameraTitle:"Kamera nicht verf\xFCgbar",noDuplicates:"Datei '%{fileName}' existiert bereits und kann nicht erneut hinzugef\xFCgt werden",noFilesFound:"Sie haben hier keine Dateien oder Ordner",noInternetConnection:"Keine Internetverbindung",noMoreFilesAllowed:"W\xE4hrend der Upload l\xE4uft, k\xF6nnen keine weiteren Dateien hinzugef\xFCgt werden",openFolderNamed:"Ordner %{name} \xF6ffnen",pause:"Pausieren",paused:"Pausiert",pauseUpload:"Hochladen pausieren",pluginNameBox:"Box",pluginNameCamera:"Kamera",pluginNameDropbox:"Dropbox",pluginNameFacebook:"Facebook",pluginNameGoogleDrive:"Google Drive",pluginNameInstagram:"Instagram",pluginNameOneDrive:"OneDrive",pluginNameZoom:"Zoom",poweredBy:"Powered by %{uppy}",processingXFiles:{0:"Eine Datei verarbeiten",1:"%{smart_count} Dateien verarbeiten"},recording:"Aufnahme",recordingLength:"Aufnahmedauer %{recording_length}",recordingStoppedMaxSize:"Die Aufnahme wurde gestoppt, weil die Dateigr\xF6\xDFe das Limit \xFCberschritten hat",recordVideoBtn:"Video aufnehmen",recoveredAllFiles:"Wir haben alle Dateien wiederhergestellt. Sie k\xF6nnen mit dem Hochladen fortfahren.",recoveredXFiles:{0:"Wir konnten eine Datei nicht vollst\xE4ndig wiederherstellen. Bitte w\xE4hlen Sie sie erneut aus und fahren Sie dann mit dem Hochladen fort.",1:"Wir konnten %{smart_count} Dateien nicht vollst\xE4ndig wiederherstellen. Bitte w\xE4hlen Sie sie erneut aus und fahren Sie dann mit dem Hochladen fort."},removeFile:"Datei entfernen",reSelect:"Erneut ausw\xE4hlen",resetFilter:"Filter zur\xFCcksetzen",resume:"Fortsetzen",resumeUpload:"Hochladen fortsetzen",retry:"Erneut versuchen",retryUpload:"Hochladen erneut versuchen",revert:"R\xFCckg\xE4ngig machen",rotate:"Drehen",save:"Speichern",saveChanges:"\xC4nderungen speichern",searchImages:"Suche nach Bildern",selectX:{0:"W\xE4hlen Sie %{smart_count}",1:"W\xE4hlen Sie %{smart_count}"},sessionRestored:"",smile:"Bitte l\xE4cheln!",startCapturing:"Bildschirmaufnahme starten",startRecording:"Videoaufnahme starten",stopCapturing:"Bildschirmaufnahme stoppen",stopRecording:"Videoaufnahme stoppen",streamActive:"Stream aktiv",streamPassive:"Stream passiv",submitRecordedFile:"Aufgezeichnete Datei verwenden",takePicture:"Ein Foto aufnehmen",takePictureBtn:"Foto aufnehmen",timedOut:"Upload f\xFCr %{seconds} Sekunden stehen geblieben, breche ab.",upload:"Hochladen",uploadComplete:"Hochladen abgeschlossen",uploadFailed:"Hochladen fehlgeschlagen",uploading:"Wird hochgeladen",uploadingXFiles:{0:"Eine Datei wird hochgeladen",1:"%{smart_count} Dateien werden hochgeladen"},uploadPaused:"Hochladen pausiert",uploadXFiles:{0:"Eine Datei hochladen",1:"%{smart_count} Dateien hochladen"},uploadXNewFiles:{0:"+%{smart_count} Datei hochladen",1:"+%{smart_count} Dateien hochladen"},xFilesSelected:{0:"Eine Datei ausgew\xE4hlt",1:"%{smart_count} Dateien ausgew\xE4hlt"},xMoreFilesAdded:{0:"Eine weitere Datei hinzugef\xFCgt",1:"%{smart_count} weitere Dateien hinzugef\xFCgt"},xTimeLeft:"%{time} verbleibend",youCanOnlyUploadFileTypes:"Sie k\xF6nnen nur folgende Dateitypen hochladen: %{types}",youCanOnlyUploadX:{0:"Sie k\xF6nnen nur eine Datei hochladen",1:"Sie k\xF6nnen nur %{smart_count} Dateien hochladen"},youHaveToAtLeastSelectX:{0:"Sie m\xFCssen mindestens eine Datei ausw\xE4hlen",1:"Sie m\xFCssen mindestens %{smart_count} Dateien ausw\xE4hlen"},zoomIn:"Vergr\xF6\xDFern",zoomOut:"Verkleinern"};typeof Uppy<"u"&&(globalThis.Uppy.locales.de_DE=ge);var nt=ge;var ne="thumbnails";var ae="partyHash";var at="/video_thumb.png",K="vidthu_start_",W="_vidthu_end.jpeg";function ot(i){return i.replace(/\//g,"--")}function rt(i){return i.replace(/--/g,"/")}var st="thumbnailsSigned",oe=(()=>{class i{saveFullResSignedUrl(t,e,n){let a=Date.now()+n,s={signedUrl:e,expiredAtTicks:a};localStorage.setItem(t,JSON.stringify(s))}readCachedFullResSignedUrl(t){let e=localStorage.getItem(t);if(!e)return;let n=JSON.parse(e),a=Date.now();if(n.expiredAtTicks>a)return n.signedUrl}saveThumbnailSignedUrls(t,e){let n=Date.now()+e,a=this.loadAndPrepareCache();for(let[o,r]of t.entries())a[o]={expiredAtTicks:n,signedUrl:r};let s=JSON.stringify(a);localStorage.setItem(st,s)}readCachedThumbnailSignedUrls(){let t=this.loadAndPrepareCache();return new Map(Object.entries(t).map(([e,n])=>[e,n.signedUrl]))}loadAndPrepareCache(){let t=localStorage.getItem(st),e={};if(!t)return e;try{let n=JSON.parse(t);e=this.clearOldData(n)}catch{console.warn("Failed to parse signed URL cache")}return e}clearOldData(t){let e=Date.now(),n=Object.entries(t).filter(([,a])=>a.expiredAtTicks>e);return Object.fromEntries(n)}static \u0275fac=function(e){return new(e||i)};static \u0275prov=H({token:i,factory:i.\u0275fac})}return i})();var ft=".emptyFolderPlaceholder",Q=(()=>{class i{supabaseService=p(Qe);titleService=p(He);imageCacheService=p(oe);destroyRef=p(ee);constructor(){this.destroyRef.onDestroy(async()=>{(await this.supabaseService.supabase.auth.getUser()).data?.user?.is_anonymous&&await this.supabaseService.supabase.auth.signOut({scope:"global"})})}partyHash=_(void 0);anonUser=z({params:()=>this.partyHash(),loader:async t=>{let e=await this.supabaseService.supabase.auth.getUser(),n=await this.supabaseService.supabase.auth.getSession(),a={user:e.data.user,session:n.data.session};return(!a.session||!a.user||a.user.user_metadata[ae]!==t.params)&&(a=(await this.supabaseService.supabase.auth.signInAnonymously({options:{data:{partyHash:t.params}}})).data),a}});anonUser$=N(this.anonUser.value);mandatoryMeta=z({params:()=>this.anonUser.value(),loader:async()=>{let t=this.partyHash(),{data:e,error:n}=await this.supabaseService.supabase.from("upload_mandator").select("*");if(n)throw new Error(n.message);if(!e||e.length!==1)throw new Error("no mandator found");let a=e[0];return this.titleService.setTitle(`\u2665 ${a.header_name} \u2665`),a}});imageMetaActive=_(void 0);imageMeta=z({params:()=>this.imageMetaActive(),loader:async()=>{let t=this.partyHash();if(!t)return[];let e=`${t}/${ne}`,{data:n,error:a}=await this.supabaseService.supabase.storage.from(t).list(e,{sortBy:{column:"updated_at",order:"desc"}});if(a||!n)return console.warn("Error fetching file list or no data",a),[];let s=n.filter(m=>m.name!==ft),o=this.imageCacheService.readCachedThumbnailSignedUrls(),r=s.map((m,F)=>{let O=`${e}/${m.name}`,Y=o.get(O),w=`${t}/${m.name}`,U;if(w.endsWith(W)){let J=w.indexOf(K),se=w.indexOf(W);J!==-1&&se!==-1&&se>J&&(U=rt(w.substring(J+K.length,se)),w=w.substring(0,J))}return j(k({},m),{thumbnailPath:O,thumbnailSignedUrl:Y,fullResPath:w,fullResType:U,idx:F})}),h=r.filter(m=>m.thumbnailSignedUrl===void 0).map(m=>m.thumbnailPath),d={data:[],error:new Ze("no Paths")};h.length>0&&(d=await this.supabaseService.supabase.storage.from(t).createSignedUrls(h,43200));let b=new Map(d.data?.filter(m=>m.error===null&&m.path!==void 0).map(({path:m,signedUrl:F})=>[m,F])??[]);return this.imageCacheService.saveThumbnailSignedUrls(b,432e5),r.map((m,F)=>j(k({},m),{thumbnailSignedUrl:m.thumbnailSignedUrl||b.get(m.thumbnailPath),idx:F}))}});static \u0275fac=function(e){return new(e||i)};static \u0275prov=H({token:i,factory:i.\u0275fac})}return i})();var bt=(i,c)=>[i,c],re=(()=>{class i{hostClass=S("",{alias:"class"});contentHeight=S(!1);static \u0275fac=function(e){return new(e||i)};static \u0275cmp=V({type:i,selectors:[["lib-loading-indicator"]],inputs:{hostClass:[1,"class","hostClass"],contentHeight:[1,"contentHeight"]},decls:5,vars:4,consts:[[1,"flex","items-center","justify-center","bg-ivory",3,"ngClass"],[1,"flex","flex-col","items-center","gap-4"],[1,"relative","w-20","h-20"],["xmlns","http://www.w3.org/2000/svg","fill","currentColor","viewBox","0 0 24 24",1,"absolute","w-14","h-14","text-sage-green","inset-1/2","-translate-x-1/2","-translate-y-1/2","animate-bounce"],["d",`M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 
             6.5 3.5 5 5.5 5c1.54 0 3.04.99 
             3.57 2.36h1.87C13.46 5.99 14.96 5 
             16.5 5 18.5 5 20 6.5 20 8.5c0 
             3.78-3.4 6.86-8.55 11.54L12 21.35z`]],template:function(e,n){e&1&&(l(0,"div",0)(1,"div",1)(2,"div",2),C(),l(3,"svg",3),v(4,"path",4),u()()()()),e&2&&f("ngClass",Ae(1,bt,n.contentHeight()?"h-full":"min-h-dvh",n.hostClass()))},dependencies:[B,ie],styles:["[_nghost-%COMP%]{display:contents}"]})}return i})();var dt=ht(lt(),1);var ye;try{ye=!!new Blob}catch{ye=!1}var _e=(()=>{class i{get isFileSaverSupported(){return ye}genType(t){if(!t||t.lastIndexOf(".")===-1)return"text/plain";let e=t.substring(t.lastIndexOf(".")+1);switch(e){case"txt":return"text/plain";case"xml":case"html":return`text/${e}`;case"json":return"octet/stream";default:return`application/${e}`}}save(t,e,n,a){if(!t)throw new Error("Data argument should be a blob instance");let s=new Blob([t],{type:n||t.type||this.genType(e)});(0,dt.saveAs)(s,decodeURI(e||"download"),a)}saveText(t,e,n){let a=new Blob([t]);this.save(a,e,void 0,n)}static \u0275fac=function(e){return new(e||i)};static \u0275prov=H({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),ct=(()=>{class i{ngZone=p(Ue);el=p(Ce);fss=p(_e);httpClient=p(Oe);method=S("GET");http=S();query=S();header=S();url=S.required();fileName=S();fsOptions=S();successEmitter=new le;success=pe(this.successEmitter);errorEmitter=new le;error=pe(this.errorEmitter);d$=p(ee);constructor(){this.fss.isFileSaverSupported||this.el.nativeElement.classList.add("filesaver__not-support")}ngOnInit(){this.ngZone.runOutsideAngular(()=>this.setupClickListener())}getName(t){return decodeURI(this.fileName()||t.headers.get("filename")||t.headers.get("x-filename")||"")}setDisabled(t){let e=this.el.nativeElement;e.disabled=t,e.classList[t?"add":"remove"]("filesaver__disabled")}setupClickListener(){xe(this.el.nativeElement,"click").pipe(G(()=>this.fss.isFileSaverSupported),T(this.d$)).subscribe(()=>{let t=this.http();if(!t){let e=new Ne,n=this.query()||{};for(let a in n)e=e.set(a,n[a]);t=this.httpClient.request(this.method(),this.url(),{observe:"response",responseType:"blob",headers:this.header(),params:e})}this.setDisabled(!0),t.pipe(T(this.d$)).subscribe({next:e=>{if(e.status!==200||e.body.size<=0){this.errorEmitter.next(e);return}this.fss.save(e.body,this.getName(e),void 0,this.fsOptions()),this.successEmitter.next(e)},error:e=>this.errorEmitter.next(e),complete:()=>this.setDisabled(!1)})})}static \u0275fac=function(e){return new(e||i)};static \u0275dir=Te({type:i,selectors:[["","fileSaver",""]],inputs:{method:[1,"method"],http:[1,"http"],query:[1,"query"],header:[1,"header"],url:[1,"url"],fileName:[1,"fileName"],fsOptions:[1,"fsOptions"]},outputs:{success:"success",error:"error"},exportAs:["fileSaver"]})}return i})(),ut=(()=>{class i{static \u0275fac=function(e){return new(e||i)};static \u0275mod=Ee({type:i});static \u0275inj=Se({})}return i})();function _t(i,c){i&1&&(l(0,"div",7),v(1,"lib-loading-indicator",14),u()),i&2&&(g(),f("contentHeight",!0))}function wt(i,c){i&1&&v(0,"lib-loading-indicator",15),i&2&&f("contentHeight",!0)}function xt(i,c){if(i&1){let t=L();l(0,"video",18),x("loadedmetadata",function(){M(t);let n=y(2);return I(n.imgLoaded())}),v(1,"source",19),R(2," Your browser does not support the video tag. "),u()}if(i&2){let t=y(2);f("playsInline",!0),g(),f("src",t.imgMeta.value(),$)("type",t.mimeType())}}function St(i,c){if(i&1){let t=L();l(0,"img",20),x("load",function(){M(t);let n=y(2);return I(n.imgLoaded())}),u()}if(i&2){let t=y(2);f("src",t.imgMeta.value(),$)}}function Ct(i,c){if(i&1&&(D(0,wt,1,1,"lib-loading-indicator",15),D(1,xt,3,3,"video",16)(2,St,1,1,"img",17)),i&2){let t=y();E(t.imageLoading()?0:-1),g(),E(t.isVideo()?1:2)}}var mt=(()=>{class i{fileSaver=p(_e);dialogRef=p(Xe);imageUploadService=p(Q);idx=_(void 0);imageLoading=_(!0);data=A(()=>{let t=this.idx();if(t===void 0)return;let e=this.imageUploadService.imageMeta.value();if(e!==void 0)return e[t]});mimeType=A(()=>{let t=this.data();if(t?.fullResType)return t.fullResType;let e=t?.metadata;return e&&"mimetype"in e&&typeof e.mimetype=="string"?e.mimetype:"image/*"});isVideo=A(()=>this.mimeType().includes("video"));maxIdx=A(()=>{let t=this.imageUploadService.imageMeta.value()?.length;if(t!==void 0)return t-1});minIdx=0;imgMeta=z({params:()=>this.data(),loader:async t=>{this.imageLoading.set(!0);let e=t.params.fullResPath,n=this.imageUploadService.imageCacheService.readCachedFullResSignedUrl(e);if(n)return n;let a=this.imageUploadService.partyHash();if(!a)return;let{data:s,error:o}=await this.imageUploadService.supabaseService.supabase.storage.from(a).createSignedUrl(e,43200);if(!s||o)throw new Error(o?.message||"data null");return this.imageUploadService.imageCacheService.saveFullResSignedUrl(e,s.signedUrl,432e5),s.signedUrl}});constructor(t){this.idx.set(t.idx)}next(){this.idx.update(t=>{let e=t===void 0?void 0:t+1;return(e??0)>(this.maxIdx()??0)?this.minIdx:e})}previous(){this.idx.update(t=>{let e=t===void 0?void 0:t-1;return(e??0)<this.minIdx?this.maxIdx():e})}imgLoaded(){this.imageLoading.set(!1)}static \u0275fac=function(e){return new(e||i)(De(qe))};static \u0275cmp=V({type:i,selectors:[["lib-image-viewer"]],decls:19,vars:3,consts:[[1,"w-[95dvw]","mx-auto","p-2"],[1,"bg-ivory","rounded-2xl","shadow-lg","overflow-hidden","border","border-primary-border"],[1,"flex","justify-end","p-2"],["type","button",1,"text-lg","text-nowrap","font-semibold","rounded-md","bg-ivory","px-3","py-2","shadow-xs","ring-1","ring-gold","ring-inset","text-gold",3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","currentColor","stroke","currentColor","viewBox","0 0 320 512",1,"size-5","text-gold"],["d","M342.6 150.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L192 210.7 86.6 105.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L146.7 256 41.4 361.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L192 301.3 297.4 406.6c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L237.3 256 342.6 150.6z"],[1,"w-full","h-[70dvh]","flex","items-center","justify-center","relative"],[1,"h-full","w-full"],[1,"text-center","p-3","w-full","flex","justify-between"],["d","M9.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l192 192c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L77.3 256 246.6 86.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-192 192z"],["fileSaver","","type","button",1,"text-lg","text-nowrap","font-semibold","rounded-md","bg-ivory","px-3","py-2","shadow-xs","ring-1","ring-gold","ring-inset","text-gold",3,"method","url"],["xmlns","http://www.w3.org/2000/svg","fill","currentColor","stroke","currentColor","viewBox","0 0 512 512",1,"size-5","text-gold"],["d","M288 32c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 242.7-73.4-73.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l128 128c12.5 12.5 32.8 12.5 45.3 0l128-128c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L288 274.7 288 32zM64 352c-35.3 0-64 28.7-64 64l0 32c0 35.3 28.7 64 64 64l384 0c35.3 0 64-28.7 64-64l0-32c0-35.3-28.7-64-64-64l-101.5 0-45.3 45.3c-25 25-65.5 25-90.5 0L165.5 352 64 352zm368 56a24 24 0 1 1 0 48 24 24 0 1 1 0-48z"],["d","M310.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-192 192c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L242.7 256 73.4 86.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l192 192z"],[3,"contentHeight"],[1,"absolute","inset-0",3,"contentHeight"],["controls","",1,"max-h-full","max-w-full","object-contain",3,"playsInline"],[1,"max-h-full","max-w-full","object-contain",3,"src"],["controls","",1,"max-h-full","max-w-full","object-contain",3,"loadedmetadata","playsInline"],[3,"src","type"],[1,"max-h-full","max-w-full","object-contain",3,"load","src"]],template:function(e,n){e&1&&(l(0,"div",0)(1,"div",1)(2,"div",2)(3,"button",3),x("click",function(){return n.dialogRef.close()}),C(),l(4,"svg",4),v(5,"path",5),u()()(),P(),l(6,"div",6),D(7,_t,2,1,"div",7)(8,Ct,3,2),u(),l(9,"div",8)(10,"button",3),x("click",function(){return n.previous()}),C(),l(11,"svg",4),v(12,"path",9),u()(),P(),l(13,"button",10),C(),l(14,"svg",11),v(15,"path",12),u()(),P(),l(16,"button",3),x("click",function(){return n.next()}),C(),l(17,"svg",4),v(18,"path",13),u()()()()()),e&2&&(g(7),E(n.imgMeta.isLoading()?7:8),g(6),f("method","GET")("url",n.imgMeta.value()??""))},dependencies:[B,re,ut,ct],styles:["[_nghost-%COMP%]{display:contents}"]})}return i})();var Dt=["uppyContainer"],we=i=>[i],Et=i=>({"animate-spin":i}),Tt=(i,c)=>c.id;function Ft(i,c){i&1&&v(0,"lib-loading-indicator")}function Ut(i,c){if(i&1){let t=L();l(0,"div",7)(1,"button",14),x("click",function(){M(t);let n=y(2);return I(n.triggerUppySelector())}),R(2),ce(3,"transloco"),u()()}i&2&&(g(2),ke(" ",ue(3,1,"imageUploader.selectPhotos")," "))}function Mt(i,c){i&1&&(l(0,"div",9)(1,"div",15),C(),l(2,"svg",16),v(3,"circle",17)(4,"path",18),u(),P(),l(5,"span"),R(6),ce(7,"transloco"),u()()()),i&2&&(g(6),te(ue(7,1,"imageUploader.loadingGallery")))}function It(i,c){if(i&1){let t=L();l(0,"div")(1,"div",20),x("click",function(){let n=M(t).$implicit,a=y(3);return I(a.openDialog(n))}),v(2,"img",21),u()()}if(i&2){let t=c.$implicit;g(2),f("src",t.thumbnailSignedUrl,$)}}function Lt(i,c){if(i&1&&(l(0,"cdk-virtual-scroll-viewport",10,1),Fe(2,It,3,1,"div",19),u()),i&2){let t=y(2);f("itemSize",t.imgHeight()),g(2),f("cdkVirtualForOf",t.imageUploadService.imageMeta.value())("cdkVirtualForTrackBy",t.trackByFn)}}function kt(i,c){if(i&1){let t=L();C(),l(0,"svg",26),x("click",function(){M(t);let n=y(3);return I(n.imageUploadService.imageMeta.reload())}),v(1,"path",27),u()}if(i&2){let t=y(3);f("ngClass",X(1,Et,t.imageUploadService.imageMeta.isLoading()))}}function Rt(i,c){i&1&&v(0,"div",23)}function At(i,c){if(i&1){let t=L();l(0,"button",22),x("click",function(){let n=M(t).$implicit,a=y(2);return I(a.activeTab.set(n))}),v(1,"div",23),l(2,"span",24),R(3),u(),D(4,kt,2,3,":svg:svg",25)(5,Rt,1,0,"div",23),u()}if(i&2){let t=c.$implicit,e=y(2);f("ngClass",X(3,we,e.activeTab().id===t.id?"border-gold":"border-transparent")),g(3),te(t.name),g(),E(t.hideIcon?5:4)}}function Nt(i,c){if(i&1&&(l(0,"div",2)(1,"div",3)(2,"h1",4),R(3),u()(),l(4,"div",5)(5,"div",6,0),D(7,Ut,4,3,"div",7),u(),l(8,"div",8),D(9,Mt,8,3,"div",9)(10,Lt,3,3,"cdk-virtual-scroll-viewport",10),u()(),l(11,"div",11)(12,"div",12),Me(13,At,6,5,"button",13,Tt),u()()()),i&2){let t,e=y();g(3),te((t=e.imageUploadService.mandatoryMeta.value())==null?null:t.header_name),g(2),f("ngClass",X(5,we,e.activeTab().id==="upload"?"flex":"hidden")),g(2),E(e.showFileButton()?7:-1),g(),f("ngClass",X(7,we,e.activeTab().id==="gallery"?"z-10":"-z-50")),g(),E(e.imageUploadService.imageMeta.isLoading()||!e.imageUploadService.imageMeta.hasValue()?9:10),g(4),Ie(e.tabs())}}var pt=(()=>{class i{dialog=p(Ke);route=p(Pe);transloco=p(Ve);imageUploadService=p(Q);tabs=_([{id:"upload",name:this.transloco.translate("imageUploader.upload"),hideIcon:!0},{id:"gallery",name:this.transloco.translate("imageUploader.gallery"),hideIcon:!1}]);activeTab=_(this.tabs()[0]);activeTab$=N(this.activeTab);galleryContainer=me(q);galleryContainer$=N(this.galleryContainer);uppyContainer=me("uppyContainer");uppyContainer$=N(this.uppyContainer);uppyReadyToLoad=A(()=>{let t=this.uppyContainer(),e=this.imageUploadService.anonUser.value();return t?.nativeElement!==void 0&&e?.session?.access_token!==void 0});uppyReadyToLoad$=N(this.uppyReadyToLoad);uppy=_(void 0);imgHeight=_(200);showFileButton=_(!0);trackByFn(t,e){return e.id}triggerUppySelector(){document.querySelector("[data-uppy-super-focusable]").click()}observer;constructor(){this.uppyReadyToLoad$.pipe(T(),G(t=>t===!0)).subscribe(()=>this.initUppy()),this.uppyContainer$.pipe(T(),G(t=>!!t)).subscribe(t=>{this.observer?.disconnect(),this.observer=new MutationObserver(()=>{let e=document.querySelector(".uppy-Dashboard-AddFiles-title");this.showFileButton.set(e!==null)}),this.observer.observe(t?.nativeElement,{childList:!0,subtree:!0})}),this.galleryContainer$.pipe(T()).subscribe(t=>{let e=t?.elementRef.nativeElement;if(!e)return;let n=(e.clientWidth-16-32)*.7/4;this.imgHeight.set(n)}),this.activeTab$.pipe(T()).subscribe(t=>{if(t.id!=="upload")switch(this.imageUploadService.imageMeta.status()){case"idle":this.imageUploadService.imageMetaActive.set(!0);break}}),this.route.queryParams.pipe(T()).subscribe(t=>{let e=t[ae];this.imageUploadService.partyHash.set(e)})}initUppy(){document.querySelector(".uppy-Root")===null&&this.uppy.set(new Ye({debug:!1,autoProceed:!1,locale:nt,onBeforeFileAdded(e,n){return j(k({},e),{name:`${Date.now()}__${e.name}`})}}).use(tt,{inline:!0,hideProgressDetails:!1,disableThumbnailGenerator:!1,height:"100%",width:"100dvw",target:"[uppy-container]"}).use(et,{thumbnailHeight:300,waitForThumbnailsBeforeUpload:!0}).use(Je,{quality:.8}).use(it,{endpoint:this.imageUploadService.supabaseService.supabaseStorageURL,headers:{authorization:`Bearer ${this.imageUploadService.anonUser.value()?.session?.access_token}`,apikey:this.imageUploadService.supabaseService.supabaseToken.supabaseKey},uploadDataDuringCreation:!1,removeFingerprintOnSuccess:!0,chunkSize:6*1024*1024,allowedMetaFields:["bucketName","objectName","contentType","cacheControl"],onError:function(e){console.log("Failed because: "+e)}}).on("file-added",async e=>{let n=this.imageUploadService.partyHash(),a={bucketName:n,objectName:`${n}/${e.name}`,contentType:e.type,name:e.name??e.meta.name};if(e.type.includes("video"))try{let s=await this.generateVideoThumbnail(e);e.preview=s?URL.createObjectURL(s):at}catch(s){console.error(s)}e.meta=k(k({},e.meta),a)}).on("complete",e=>{this.imageUploadService.imageMetaActive.set(void 0)}).on("upload-success",async e=>{if(!e?.meta.name||!e?.preview)return;let n=this.imageUploadService.partyHash(),a=`${e.meta.name}`;e.meta.type&&e.meta.type.includes("video")&&(a=`${a}${K}${ot(e.type)}${W}`,e.type="image/jpeg");let s=`${n}/${ne}/${a}`,r=await(await fetch(e.preview)).blob(),h=new File([r],a,{type:e.type});await this.imageUploadService.supabaseService.supabase.storage.from(n).upload(s,h)}))}async generateVideoThumbnail(t){if(t?.data)return new Promise((e,n)=>{let a=document.createElement("video");a.preload="metadata",a.muted=!0,a.src=URL.createObjectURL(t.data),a.addEventListener("loadedmetadata",()=>{a.currentTime=1}),a.addEventListener("seeked",()=>{let s=document.createElement("canvas");s.width=a.videoWidth,s.height=a.videoHeight;let o=s.getContext("2d");if(!o){URL.revokeObjectURL(a.src),n(new Error("Unable to get canvas context"));return}o.drawImage(a,0,0,s.width,s.height),s.toBlob(r=>{if(URL.revokeObjectURL(a.src),!r){n(new Error("Failed to create thumbnail blob"));return}let h=new File([r],"thumbnail.jpg",{type:"image/jpeg"});e(h)},"image/jpeg")}),a.onerror=s=>{URL.revokeObjectURL(a.src),n(new Error("Video failed to load"))}})}ngOnDestroy(){this.observer?.disconnect()}openDialog(t){this.dialog.open(mt,{data:{idx:t.idx}})}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=V({type:i,selectors:[["lib-gallery-page"]],viewQuery:function(e,n){e&1&&(de(n.galleryContainer,q,5),de(n.uppyContainer,Dt,5)),e&2&&Le(2)},features:[Re([Q,oe])],decls:2,vars:1,consts:[["uppyContainer",""],["galleryContainer",""],[1,"h-dvh","w-dvw","flex","flex-col","overflow-hidden"],[1,"flex","items-center","justify-center","p-4","flex-initial","text-gold","bg-ivory"],[1,"text-3xl","font-semibold"],[1,"flex-1","flex","justify-center","items-center","flex-col","relative","overflow-hidden"],["uppy-container","",1,"max-w-full","flex-col","flex-auto","gap-2","relative","h-full","overflow-hidden",3,"ngClass"],[1,"absolute","inset-0","flex","justify-center","items-center"],[1,"flex-auto","w-full","flex","flex-col","absolute","inset-0",3,"ngClass"],[1,"flex-auto","w-full","flex","justify-center","items-center","bg-ivory"],["appendOnly","",1,"p-4","flex-auto","w-full","bg-ivory",3,"itemSize"],[1,"border-t","border-primary-border","flex-initial","bg-ivory"],[1,"-mb-px","flex"],[1,"flex-1","border-t-2","px-1","py-4","text-center","text-lg","font-semibold","text-gold","flex","gap-2","items-center",3,"ngClass"],["type","button",1,"z-[2000]","text-lg","text-nowrap","font-semibold","rounded-md","bg-ivory","px-3","py-2","shadow-xs","ring-1","ring-gold","ring-inset","text-gold",3,"click"],[1,"flex","gap-2","items-center"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24",1,"size-5","animate-spin","text-gold"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","4",1,"opacity-25"],["fill","currentColor","d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z",1,"opacity-75"],[4,"cdkVirtualFor","cdkVirtualForOf","cdkVirtualForTrackBy"],[1,"group","overflow-hidden","rounded-lg","bg-gray-100","focus-within:ring-2","focus-within:ring-indigo-500","focus-within:ring-offset-2","focus-within:ring-offset-gray-100",3,"click"],[1,"pointer-events-none","aspect-10/7","object-cover","group-hover:opacity-75",3,"src"],[1,"flex-1","border-t-2","px-1","py-4","text-center","text-lg","font-semibold","text-gold","flex","gap-2","items-center",3,"click","ngClass"],[1,"flex-1"],[1,"flex-2"],["xmlns","http://www.w3.org/2000/svg","height","20","width","20","viewBox","0 0 512 512",1,"flex-1","size-5","text-gold","fill-gold",3,"ngClass"],["xmlns","http://www.w3.org/2000/svg","height","20","width","20","viewBox","0 0 512 512",1,"flex-1","size-5","text-gold","fill-gold",3,"click","ngClass"],["fill","currentColor","d","M105.1 202.6c7.7-21.8 20.2-42.3 37.8-59.8c62.5-62.5 163.8-62.5 226.3 0L386.3 160 352 160c-17.7 0-32 14.3-32 32s14.3 32 32 32l111.5 0c0 0 0 0 0 0l.4 0c17.7 0 32-14.3 32-32l0-112c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 35.2L414.4 97.6c-87.5-87.5-229.3-87.5-316.8 0C73.2 122 55.6 150.7 44.8 181.4c-5.9 16.7 2.9 34.9 19.5 40.8s34.9-2.9 40.8-19.5zM39 289.3c-5 1.5-9.8 4.2-13.7 8.2c-4 4-6.7 8.8-8.1 14c-.3 1.2-.6 2.5-.8 3.8c-.3 1.7-.4 3.4-.4 5.1L16 432c0 17.7 14.3 32 32 32s32-14.3 32-32l0-35.1 17.6 17.5c0 0 0 0 0 0c87.5 87.4 229.3 87.4 316.7 0c24.4-24.4 42.1-53.1 52.9-83.8c5.9-16.7-2.9-34.9-19.5-40.8s-34.9 2.9-40.8 19.5c-7.7 21.8-20.2 42.3-37.8 59.8c-62.5 62.5-163.8 62.5-226.3 0l-.1-.1L125.6 352l34.4 0c17.7 0 32-14.3 32-32s-14.3-32-32-32L48.4 288c-1.6 0-3.2 .1-4.8 .3s-3.1 .5-4.6 1z"]],template:function(e,n){e&1&&D(0,Ft,1,0,"lib-loading-indicator")(1,Nt,15,9,"div",2),e&2&&E(n.imageUploadService.mandatoryMeta.status()!=="resolved"?0:1)},dependencies:[B,ie,$e,je,Ge,q,re,We,Be,ze],styles:['[_nghost-%COMP%]{display:contents;font-family:var(--font-amaticsc, "amaticsc", sans-serif)}[_nghost-%COMP%]     .uppy-Root, [_nghost-%COMP%]     .uppy-Dashboard, [_nghost-%COMP%]     .uppy-Dashboard-inner{display:flex;flex:1 1 auto;flex-direction:column;background-color:var(--color-sage-green)!important}[_nghost-%COMP%]     .uppy-Dashboard-inner{height:unset}[_nghost-%COMP%]     .uppy-Dashboard-AddFiles{border:0!important}[_nghost-%COMP%]     .uppy-Dashboard-AddFiles-title{opacity:0}[_nghost-%COMP%]     .uppy-StatusBar.is-waiting .uppy-StatusBar-actionBtn--upload{background-color:var(--color-gold)!important}[_nghost-%COMP%]     .uppy-Dashboard-files>*:first-child{height:100%!important}']})}return i})();var Xi=[{path:"",component:pt}];export{pt as GalleryPageComponent,Xi as imageUploaderRoutes};
