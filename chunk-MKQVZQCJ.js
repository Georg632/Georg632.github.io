import{e as yt,f as Lt}from"./chunk-FRVKC6WI.js";import{$a as z,$b as fe,$c as nt,$d as ct,Ba as M,C as ne,Ca as ae,Ce as Pe,Da as d,Dd as st,F as oe,Fa as u,Ia as je,J as T,Ja as Xe,K as g,Ka as le,L as h,Na as de,Pa as Se,Pb as pe,Qa as y,Qb as ue,Qd as J,Ra as W,Rc as et,S as p,Sa as k,Sc as be,Sd as at,T as S,Tb as P,U as $e,Ua as $,Ub as ge,Ud as lt,Va as j,Wa as X,Wb as K,Wc as tt,X as Z,Yb as he,Zd as H,_ as s,_a as Ue,_c as it,_d as dt,a as ie,ac as Ze,ae as mt,b as ze,bb as Qe,bd as ot,be as pt,c as Re,cc as Ge,ce as ut,d as Oe,dd as ve,ec as _e,fa as V,fb as b,fc as Je,gb as v,ge as Ce,ha as D,hd as rt,ia as A,ie as gt,jb as c,je as ht,ka as xe,kc as Y,ke as Te,l as E,lb as ce,le as ft,m as L,ma as I,mb as G,mc as R,na as N,nb as m,nc as O,oa as B,ob as Me,oe as ke,p as qe,qb as Ke,qe as ye,ra as re,rb as U,sa as se,se as _t,t as F,ta as _,te as bt,u as We,ua as a,ub as me,ue as vt,va as l,ve as Ct,w,wa as f,xb as Ye,z as q,zb as Q,ze as Tt}from"./chunk-FRMBERZR.js";var wt=(()=>{class n{static _uniqueId=0;id=m(`brn-toggle-${++n._uniqueId}`);value=m();disabled=m(!1,{transform:me});state=U("off");type=m("button");ariaLabel=m(null,{alias:"aria-label"});_isOn=c(()=>this.state()==="on");toggle(){this.disabled()||this.state.set(this._isOn()?"off":"on")}static \u0275fac=function(t){return new(t||n)};static \u0275dir=D({type:n,selectors:[["button","brnToggle",""]],hostVars:7,hostBindings:function(t,i){t&1&&d("click",function(){return i.toggle()}),t&2&&(ae("id",i.id())("type",i.type()),I("disabled",i.disabled()?!0:null)("data-disabled",i.disabled()?!0:null)("data-state",i.state())("aria-pressed",i._isOn())("aria-label",i.ariaLabel()||null))},inputs:{id:[1,"id"],value:[1,"value"],disabled:[1,"disabled"],state:[1,"state"],type:[1,"type"],ariaLabel:[1,"aria-label","ariaLabel"]},outputs:{state:"stateChange"}})}return n})();var Ht=ge('hover:bg-muted hover:text-muted-foreground focus-visible:border-ring data-[state=on]:bg-accent data-[state=on]:text-accent-foreground focus-visible:ring-ring/50 inline-flex items-center justify-center gap-2 rounded-md text-sm font-medium whitespace-nowrap transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:pointer-events-none disabled:opacity-50 [&_ng-icon]:pointer-events-none [&_ng-icon]:shrink-0 [&_ng-icon:not([class*="text-"])]:text-base',{variants:{variant:{default:"bg-transparent",outline:"border-input hover:bg-accent hover:text-accent-foreground border bg-transparent shadow-xs"},size:{default:"h-9 min-w-9 px-2",sm:"h-8 min-w-8 px-1.5",lg:"h-10 min-w-10 px-2.5"}},defaultVariants:{variant:"default",size:"default"}}),Ee=(()=>{class n{variant=m("default");size=m("default");constructor(){P(()=>Ht({variant:this.variant(),size:this.size()}))}static \u0275fac=function(t){return new(t||n)};static \u0275dir=D({type:n,selectors:[["button","hlmToggle",""]],hostAttrs:["data-slot","toggle"],inputs:{variant:[1,"variant"],size:[1,"size"]},features:[A([{directive:wt,inputs:["id","id","value","value","disabled","disabled","state","state","aria-label","aria-label","type","type"],outputs:["stateChange","stateChange"]}])]})}return n})();var Dt=(()=>{class n{variant=m("default");size=m("default");disabled=m(!1);state=U("off");isAnimating=p(!1);animationDirection=p("");constructor(){S(()=>{let e=this.state();this.animationDirection()===""&&e==="off"||(e==="on"?this.animationDirection.set("fill"):this.animationDirection.set("empty"),this.isAnimating.set(!0),setTimeout(()=>{this.isAnimating.set(!1)},800))})}animationClass=c(()=>{if(!this.isAnimating())return"";let e=this.animationDirection();return e==="fill"?"animate-bounce-shake":e==="empty"?"animate-empty":""});buttonClass=c(()=>{let e=this.state(),t=this.animationClass(),i="";return e==="on"?i="bg-green-100 hover:bg-green-200 dark:bg-green-900/30 dark:hover:bg-green-900/50 border-green-300 dark:border-green-700":i="bg-muted/50 hover:bg-muted dark:bg-muted/20 dark:hover:bg-muted/40 border-muted-foreground/20",`${t} ${i}`});iconClass=c(()=>{let e=this.state(),t=this.isAnimating();if(e==="on"){let i="text-green-600 dark:text-green-400";return t&&this.animationDirection()==="fill"?`${i} animate-fill`:i}return"text-muted-foreground/60"});static \u0275fac=function(t){return new(t||n)};static \u0275cmp=V({type:n,selectors:[["gh-shopping-basket-toggle"]],inputs:{variant:[1,"variant"],size:[1,"size"],disabled:[1,"disabled"],state:[1,"state"]},outputs:{state:"stateChange"},features:[z([R({lucideShoppingBasket:it})])],decls:2,vars:9,consts:[["hlmToggle","",1,"relative","overflow-hidden","transition-all","duration-300",3,"stateChange","variant","size","disabled","state"],["hlm","",1,"transition-all","duration-500",3,"name"]],template:function(t,i){t&1&&(a(0,"button",0),X("stateChange",function(r){return j(i.state,r)||(i.state=r),r}),f(1,"ng-icon",1),l()),t&2&&(Se(i.buttonClass()),_("variant",i.variant())("size",i.size())("disabled",i.disabled()),$("state",i.state),s(),Se(i.iconClass()),_("name","lucideShoppingBasket"))},dependencies:[Ee,H,O],styles:["@keyframes _ngcontent-%COMP%_bounce-shake{0%,to{transform:translateY(0) rotate(0) scale(1)}10%{transform:translateY(-8px) rotate(-5deg) scale(1.1)}20%{transform:translateY(-8px) rotate(5deg) scale(1.1)}30%{transform:translateY(-8px) rotate(-5deg) scale(1.1)}40%{transform:translateY(0) rotate(0) scale(1)}50%{transform:scale(.95)}60%{transform:scale(1.05)}70%{transform:scale(.98)}80%{transform:scale(1.02)}90%{transform:scale(1)}}@keyframes _ngcontent-%COMP%_fill-basket{0%{opacity:1}50%{opacity:.6;filter:brightness(1.5)}to{opacity:1}}@keyframes _ngcontent-%COMP%_empty-basket{0%{transform:scale(1);opacity:1}30%{transform:scale(.8) rotate(-10deg);opacity:.7}60%{transform:scale(1.1) rotate(10deg);opacity:.8}to{transform:scale(1) rotate(0);opacity:1}}.animate-bounce-shake[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_bounce-shake .8s ease-in-out}.animate-fill[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fill-basket .5s ease-in-out}.animate-empty[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_empty-basket .6s ease-in-out}[_nghost-%COMP%]{display:inline-block}"],changeDetection:0})}return n})();var Le=(()=>{class n{supabase=T(ye);authService=T(ft);currentListId=p(null);loadingCount=p(0);loading=c(()=>this.loadingCount()>0);items=ce({params:()=>({listId:this.currentListId()}),loader:async({params:e})=>{if(!e.listId)return[];let{data:t,error:i}=await this.supabase.supabase.from("shopping_list_item").select("*").eq("list_id",e.listId).order("created_at",{ascending:!1});if(i)throw i;return t??[]}});count=c(()=>this.items.value()?.length??0);setCurrentList(e){this.currentListId.set(e)}addItem(e,t){let i=this.currentListId();if(!i)return L({error:new Error("No list selected")});let o=this.authService.user()?.id;return o?(this.loadingCount.update(r=>r+1),E(this.supabase.supabase.from("shopping_list_item").insert({product_name:e,additional_info:t,list_id:i,creator_id:o,active:!0,active_changed:new Date().toISOString()}).select().single()).pipe(F(r=>L({error:r})),w(()=>this.loadingCount.update(r=>r-1)),ne(r=>{if(r?.error)throw r.error;this.items.reload()}),q(r=>{if(r?.error)throw r.error;return L(r.data)}))):L({error:new Error("User not authenticated")})}updateItem(e,t){return this.loadingCount.update(i=>i+1),E(this.supabase.supabase.from("shopping_list_item").update(t).eq("id",e).select().single()).pipe(F(i=>L({error:i})),w(()=>this.loadingCount.update(i=>i-1)),ne(i=>{if(i?.error)throw i.error;this.items.reload()}),q(i=>{if(i?.error)throw i.error;return L(i.data)}))}deleteItem(e){return this.loadingCount.update(t=>t+1),E(this.supabase.supabase.from("shopping_list_item").delete().eq("id",e)).pipe(F(t=>L({error:t})),w(()=>this.loadingCount.update(t=>t-1)),ne(t=>{if(t?.error)throw t.error;this.items.reload()}),q(t=>{if(t?.error)throw t.error;return L(void 0)}))}toggleItem(e,t){return this.updateItem(e,{active:t,active_changed:new Date().toISOString()})}toggleFavorite(e,t){return this.updateItem(e,{is_favored:t})}static \u0275fac=function(t){return new(t||n)};static \u0275prov=oe({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var At=n=>[n];function zt(n,C){if(n&1){let e=M();a(0,"input",9),d("ngModelChange",function(i){g(e);let o=u();return h(o.editingName.set(i))})("blur",function(){g(e);let i=u();return h(i.saveInline())})("keydown.enter",function(i){g(e);let o=u();return i.preventDefault(),h(o.saveInline())})("keydown.escape",function(){g(e);let i=u();return h(i.cancelEdit())}),l()}if(n&2){let e=u();_("id",Ue("edit-",e.item().id))("ngModel",e.editingName())}}function Rt(n,C){if(n&1){let e=M();a(0,"div",5)(1,"h3",10),d("click",function(){g(e);let i=u();return h(i.startEdit())}),y(2),l()()}if(n&2){let e=u();s(),de("text-destructive-foreground",e.isInDeleteMode()),s(),k(" ",e.item().product_name," ")}}function Ot(n,C){if(n&1){let e=M();a(0,"button",11),d("click",function(){g(e);let i=u();return h(i.confirmDelete())}),f(1,"ng-icon",12),l()}}function qt(n,C){if(n&1){let e=M();a(0,"gh-shopping-basket-toggle",13),d("stateChange",function(i){g(e);let o=u();return h(o.onBasketToggle(i))}),l(),a(1,"button",14),d("click",function(){g(e);let i=u();return h(i.confirmDelete())}),f(2,"ng-icon",12),l()}if(n&2){let e=u();_("state",e.item().active?"on":"off"),s(),_("ngClass",Qe(2,At,e.isTouchDevice()?"!hidden":"block"))}}var St=(()=>{class n{isTouchDevice=T(_t).isTouchDevice;service=T(Le);elementRef=T(Z);item=m.required();itemUpdated=G();itemDeleted=G();busyCount=p(0);busy=c(()=>this.busyCount()>0);editingName=p(null);isEditing=c(()=>this.editingName()!==null);touchStartX=p(0);touchCurrentX=p(0);isInDeleteMode=p(!1);constructor(){S(()=>{if(this.isInDeleteMode()){let t=i=>{let o=i.target;this.elementRef.nativeElement.contains(o)||this.resetSwipe()};return setTimeout(()=>{document.addEventListener("click",t),document.addEventListener("touchstart",t)},0),()=>{document.removeEventListener("click",t),document.removeEventListener("touchstart",t)}}return()=>{}})}toggleItem(){let e=this.item();this.busyCount.update(t=>t+1),this.service.toggleItem(e.id,!e.active).pipe(w(()=>this.busyCount.update(t=>t-1))).subscribe({next:()=>this.itemUpdated.emit(),error:t=>console.error("Toggle error:",t)})}onBasketToggle(e){let t=this.item(),i=e==="on";t.active!==i&&(this.busyCount.update(o=>o+1),this.service.toggleItem(t.id,i).pipe(w(()=>this.busyCount.update(o=>o-1))).subscribe({next:()=>this.itemUpdated.emit(),error:o=>console.error("Toggle error:",o)}))}deleteItem(){let e=this.item();this.busyCount.update(t=>t+1),this.service.deleteItem(e.id).pipe(w(()=>this.busyCount.update(t=>t-1))).subscribe({next:()=>this.itemDeleted.emit(),error:t=>console.error("Delete error:",t)})}startEdit(){this.editingName.set(this.item().product_name??""),setTimeout(()=>{let e=document.getElementById("edit-"+this.item().id);e?.focus(),e?.select()},0)}saveInline(){let e=(this.editingName()||"").trim(),t=this.item();if(e===(t.product_name??"").trim()){this.cancelEdit();return}this.busyCount.update(i=>i+1),this.service.updateItem(t.id,{product_name:e}).pipe(w(()=>{this.busyCount.update(i=>i-1),this.cancelEdit()})).subscribe({next:()=>this.itemUpdated.emit(),error:i=>console.error("Update error:",i)})}cancelEdit(){this.editingName.set(null)}toggleFavorite(){let e=this.item();this.busyCount.update(t=>t+1),this.service.toggleFavorite(e.id,!e.is_favored).pipe(w(()=>this.busyCount.update(t=>t-1))).subscribe({next:()=>this.itemUpdated.emit(),error:t=>console.error("Toggle favorite error:",t)})}onTouchStart(e){this.touchStartX.set(e.touches[0].clientX),this.touchCurrentX.set(e.touches[0].clientX)}onTouchMove(e){this.touchCurrentX.set(e.touches[0].clientX)}onTouchEnd(){this.touchCurrentX()-this.touchStartX()<-50&&this.isInDeleteMode.set(!this.isInDeleteMode())}resetSwipe(){this.isInDeleteMode.set(!1)}confirmDelete(){this.deleteItem()}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=V({type:n,selectors:[["lib-shopping-list-item-card"]],inputs:{item:[1,"item"]},outputs:{itemUpdated:"itemUpdated",itemDeleted:"itemDeleted"},features:[z([R({lucideTrash:ve,lucideStar:ot})])],decls:10,vars:17,consts:[["hlmCard","",1,"group","p-2","sm:p-3","relative","transition-colors","duration-300","ease-out",3,"touchstart","touchmove","touchend"],["hlmCardContent",""],[1,"flex","items-center","gap-3","w-full"],[1,"flex-1","min-w-0"],["hlmInput","",1,"w-full",3,"id","ngModel"],[1,"h-8","flex","items-center","gap-2"],["hlmBtn","","size","icon","variant","ghost","type","button",1,"flex-shrink-0",3,"click","disabled"],["hlm","","name","lucideStar","size","sm"],["hlmBtn","","variant","ghost","size","icon",1,"ml-auto","text-destructive-foreground","hover:text-destructive-foreground"],["hlmInput","",1,"w-full",3,"ngModelChange","blur","keydown.enter","keydown.escape","id","ngModel"],["hlmCardTitle","",1,"truncate","cursor-pointer","hover:text-primary",3,"click"],["hlmBtn","","variant","ghost","size","icon",1,"ml-auto","text-destructive-foreground","hover:text-destructive-foreground",3,"click"],["hlm","","name","lucideTrash","size","sm"],["size","sm","variant","outline",1,"ml-auto",3,"stateChange","state"],["hlmBtn","","variant","ghost","size","icon",3,"click","ngClass"]],template:function(t,i){t&1&&(a(0,"div",0),d("touchstart",function(r){return i.onTouchStart(r)})("touchmove",function(r){return i.onTouchMove(r)})("touchend",function(){return i.onTouchEnd()}),a(1,"div",1)(2,"div",2)(3,"div",3),N(4,zt,1,3,"input",4)(5,Rt,3,3,"div",5),l(),a(6,"button",6),d("click",function(){return i.toggleFavorite()}),f(7,"ng-icon",7),l(),N(8,Ot,2,0,"button",8)(9,qt,3,4),l()()()),t&2&&(de("opacity-60",!i.item().active)("bg-destructive",i.isInDeleteMode())("text-destructive-foreground",i.isInDeleteMode()),s(4),B(i.isEditing()?4:5),s(2),_("disabled",i.busy()),I("aria-pressed",i.item().is_favored)("aria-label",i.item().is_favored?"Remove from favorites":"Add to favorites"),s(),de("text-yellow-500",i.item().is_favored)("fill-yellow-500",i.item().is_favored)("text-muted-foreground",!i.item().is_favored),s(),B(i.isInDeleteMode()?8:9))},dependencies:[Q,Ye,Y,he,fe,_e,bt,Ct,vt,K,Ce,H,O,Dt],encapsulation:2,changeDetection:0})}return n})();var De=(()=>{class n{orientation=m("horizontal");$orientation=this.orientation;direction=m("ltr");$direction=this.direction;activeTab=U(void 0,{alias:"brnTabs"});$activeTab=this.activeTab.asReadonly();activationMode=m("automatic");$activationMode=this.activationMode;tabActivated=G();_tabs=p({});$tabs=this._tabs.asReadonly();registerTrigger(e,t){this.updateEntry(e,{trigger:t})}registerContent(e,t){this.updateEntry(e,{content:t})}unregisterTrigger(e){this.updateEntry(e,{trigger:void 0}),this.activeTab()===e&&this.activeTab.set(void 0)}unregisterContent(e){this.updateEntry(e,{content:void 0})}updateEntry(e,t){this._tabs.update(i=>{let o=i[e]??{},r=ie(ie({},o),t);if(!r.trigger&&!r.content){let te=i,{[e]:Nt}=te;return Oe(te,[Re(e)])}return ze(ie({},i),{[e]:r})})}emitTabActivated(e){this.tabActivated.emit(e)}setActiveTab(e){this.activeTab.set(e)}static \u0275fac=function(t){return new(t||n)};static \u0275dir=D({type:n,selectors:[["","brnTabs",""]],hostVars:2,hostBindings:function(t,i){t&2&&I("data-orientation",i.orientation())("dir",i.direction())},inputs:{orientation:[1,"orientation"],direction:[1,"direction"],activeTab:[1,"brnTabs","activeTab"],activationMode:[1,"activationMode"]},outputs:{activeTab:"brnTabsChange",tabActivated:"tabActivated"},exportAs:["brnTabs"]})}return n})();var we=(()=>{class n{elementRef=T(Z);_root=T(De);_orientation=this._root.$orientation;triggerFor=m.required({alias:"brnTabsTrigger"});selected=c(()=>this._root.$activeTab()===this.triggerFor());_contentId=c(()=>`brn-tabs-content-${this.triggerFor()}`);_labelId=c(()=>`brn-tabs-label-${this.triggerFor()}`);_disabled=m(!1,{alias:"disabled",transform:me});get disabled(){return this._disabled()}constructor(){S(()=>{let e=this.triggerFor();$e(()=>this._root.registerTrigger(e,this))})}focus(){this.elementRef.nativeElement.focus(),this._root.$activationMode()==="automatic"&&this.activate()}activate(){this.triggerFor()&&(this._root.setActiveTab(this.triggerFor()),this._root.emitTabActivated(this.triggerFor()))}get key(){return this.triggerFor()}ngOnDestroy(){this._root.unregisterTrigger(this.triggerFor())}static \u0275fac=function(t){return new(t||n)};static \u0275dir=D({type:n,selectors:[["button","brnTabsTrigger",""]],hostAttrs:["type","button","role","tab"],hostVars:9,hostBindings:function(t,i){t&1&&d("click",function(){return i.activate()}),t&2&&(ae("id",i._labelId())("tabIndex",i._disabled()?-1:i.selected()?0:-1),I("aria-selected",i.selected())("aria-controls",i._contentId())("aria-disabled",i._disabled())("data-state",i.selected()?"active":"inactive")("data-orientation",i._orientation())("data-disabled",i._disabled()?"":void 0)("disabled",i._disabled()?"":void 0))},inputs:{triggerFor:[1,"brnTabsTrigger","triggerFor"],_disabled:[1,"disabled","_disabled"]},exportAs:["brnTabsTrigger"]})}return n})(),Mt=(()=>{class n{_root=T(De);_orientation=this._root.$orientation;_direction=this._root.$direction;_activeTab=this._root.$activeTab;_tabs=this._root.$tabs;_elementRef=T(Z);_keyDownListener=qe(this._elementRef.nativeElement,"keydown");_keyManager;triggers=Ke(we,{descendants:!0});ngAfterContentInit(){this._keyManager=new ht(this.triggers()).withHorizontalOrientation(this._direction()).withHomeAndEnd().withPageUpDown().withWrap(),this._keyDownListener.pipe(We(1)).subscribe(()=>{let e=this._activeTab(),t=this._tabs(),i=0;if(e){let o=t[e];o&&(i=this.triggers().indexOf(o.trigger))}this._keyManager?.setActiveItem(i)}),this._keyDownListener.subscribe(e=>{"key"in e&&(this._orientation()==="horizontal"&&(e.key==="ArrowUp"||e.key==="ArrowDown")||this._orientation()==="vertical"&&(e.key==="ArrowLeft"||e.key==="ArrowRight"))||this._keyManager?.onKeydown(e)})}static \u0275fac=function(t){return new(t||n)};static \u0275dir=D({type:n,selectors:[["","brnTabsList",""]],contentQueries:function(t,i,o){t&1&&je(o,i.triggers,we,5),t&2&&le()},hostAttrs:["role","tablist"],hostVars:2,hostBindings:function(t,i){t&2&&I("aria-orientation",i._orientation())("data-orientation",i._orientation())},exportAs:["brnTabsList"]})}return n})();var xn=st({passive:!0});var Fe=(()=>{class n{tab=m.required();constructor(){P(()=>"flex flex-col gap-2")}static \u0275fac=function(t){return new(t||n)};static \u0275dir=D({type:n,selectors:[["","hlmTabs",""],["hlm-tabs"]],hostAttrs:["data-slot","tabs"],inputs:{tab:[1,"tab"]},features:[A([{directive:De,inputs:["orientation","orientation","direction","direction","activationMode","activationMode","brnTabs","tab"],outputs:["tabActivated","tabActivated"]}])]})}return n})();var kt=ge("bg-muted text-muted-foreground inline-flex h-9 w-fit items-center justify-center rounded-lg p-[3px]",{variants:{orientation:{horizontal:"h-10 space-x-1",vertical:"mt-2 h-fit flex-col space-y-1"}},defaultVariants:{orientation:"horizontal"}}),Ve=(()=>{class n{orientation=m("horizontal");constructor(){P(()=>kt({orientation:this.orientation()}))}static \u0275fac=function(t){return new(t||n)};static \u0275dir=D({type:n,selectors:[["","hlmTabsList",""],["hlm-tabs-list"]],hostAttrs:["data-slot","tabs-list"],inputs:{orientation:[1,"orientation"]},features:[A([Mt])]})}return n})();var Ae=(()=>{class n{triggerFor=m.required({alias:"hlmTabsTrigger"});constructor(){P(()=>"data-[state=active]:bg-background dark:data-[state=active]:text-foreground focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring dark:data-[state=active]:border-input dark:data-[state=active]:bg-input/30 text-foreground dark:text-muted-foreground inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-md border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:shadow-sm [&_ng-icon]:pointer-events-none [&_ng-icon]:shrink-0 [&_ng-icon:not([class*='text-'])]:text-base")}static \u0275fac=function(t){return new(t||n)};static \u0275dir=D({type:n,selectors:[["","hlmTabsTrigger",""]],hostAttrs:["data-slot","tabs-trigger"],inputs:{triggerFor:[1,"hlmTabsTrigger","triggerFor"]},features:[A([{directive:we,inputs:["brnTabsTrigger","hlmTabsTrigger","disabled","disabled"]}])]})}return n})();var Ie=(()=>{class n{supabase=T(ye);userId=p(null);loadingCount=p(0);loading=c(()=>this.loadingCount()>0);lists=ce({params:()=>({userId:this.userId()}),loader:async({params:e})=>{if(!e.userId)return[];let{data:t,error:i}=await this.supabase.supabase.from("shopping_list").select("*").eq("creator_id",e.userId).order("created_at",{ascending:!0});if(i)throw i;return t??[]}});selectedListId=p(null);selectedList=c(()=>{let e=this.selectedListId();return(this.lists.value()??[]).find(i=>i.id===e)??null});constructor(){this.supabase.supabase.auth.getSession().then(({data:e})=>{let t=e?.session?.user??null;t&&this.userId.set(t.id)}).catch(()=>{}),this.supabase.supabase.auth.onAuthStateChange((e,t)=>{let i=t?.user?.id??null;this.userId.set(i),i||this.selectedListId.set(null)}),S(()=>{let e=this.lists.value();!this.selectedListId()&&e&&e.length>0&&this.selectedListId.set(e[0].id)})}createList(e){this.loadingCount.update(t=>t+1),E(this.supabase.supabase.auth.getUser()).pipe(q(t=>{let i=t?.data?.user?.id;return i?E(this.supabase.supabase.from("shopping_list").insert({name:e,creator_id:i}).select().single()):L({error:new Error("Not authenticated")})}),F(t=>L({error:t})),w(()=>this.loadingCount.update(t=>t-1))).subscribe(t=>{if(t?.error)throw t.error;this.lists.reload(),t?.data&&this.selectedListId.set(t.data.id)})}updateList(e,t){this.loadingCount.update(i=>i+1),E(this.supabase.supabase.from("shopping_list").update({name:t}).eq("id",e).select().single()).pipe(F(i=>L({error:i})),w(()=>this.loadingCount.update(i=>i-1))).subscribe(i=>{if(i?.error)throw i.error;this.lists.reload()})}deleteList(e){this.loadingCount.update(t=>t+1),E(this.supabase.supabase.from("shopping_list").delete().eq("id",e)).pipe(F(t=>L({error:t})),w(()=>this.loadingCount.update(t=>t-1))).subscribe(t=>{if(t?.error)throw t.error;this.selectedListId()===e&&this.selectedListId.set(null),this.lists.reload()})}static \u0275fac=function(t){return new(t||n)};static \u0275prov=oe({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var Xt=["editDialog"],Ut=(n,C)=>C.id;function Qt(n,C){n&1&&f(0,"hlm-spinner",3)}function Kt(n,C){if(n&1){let e=M();a(0,"div",6)(1,"button",12),d("click",function(){let i=g(e).$implicit,o=u();return h(o.onTabChange(i.id))}),y(2),a(3,"button",13),b(4,"transloco"),d("click",function(i){let o=g(e).$implicit,r=u();return h(r.openEditDialog(i,o))}),f(5,"ng-icon",14),l(),a(6,"button",13),b(7,"transloco"),d("click",function(i){let o=g(e).$implicit,r=u();return h(r.deleteList(i,o.id))}),f(8,"ng-icon",15),l()()()}if(n&2){let e=C.$implicit;s(),_("hlmTabsTrigger",e.id),s(),k(" ",e.name," "),s(),I("aria-label",v(4,4,"common.edit")),s(3),I("aria-label",v(7,6,"common.delete"))}}function Yt(n,C){n&1&&(f(0,"hlm-spinner",3),y(1),b(2,"transloco")),n&2&&(s(),k(" ",v(2,1,"common.creating")," "))}function Zt(n,C){n&1&&(y(0),b(1,"transloco")),n&2&&k(" ",v(1,1,"common.create")," ")}function Gt(n,C){if(n&1){let e=M();a(0,"hlm-dialog-content",16)(1,"hlm-dialog-header")(2,"h3",17),y(3),b(4,"transloco"),l(),a(5,"p",18),y(6),b(7,"transloco"),l()(),a(8,"div",19)(9,"div",20)(10,"label",21),y(11),b(12,"transloco"),l(),a(13,"input",22),b(14,"transloco"),X("ngModelChange",function(i){g(e);let o=u();return j(o.newListName,i)||(o.newListName=i),h(i)}),d("keydown.enter",function(){g(e);let i=u();return h(i.createList())}),l()()(),a(15,"hlm-dialog-footer")(16,"button",23),d("click",function(){g(e);let i=u();return h(i.closeDialog())}),y(17),b(18,"transloco"),l(),a(19,"button",24),d("click",function(){g(e);let i=u();return h(i.createList())}),N(20,Yt,3,3)(21,Zt,2,3),l()()()}if(n&2){let e=u();s(3),W(v(4,8,"shoppingList.createList")),s(3),W(v(7,10,"shoppingList.createListDescription")),s(5),W(v(12,12,"shoppingList.listName")),s(2),$("ngModel",e.newListName),_("placeholder",v(14,14,"shoppingList.listNamePlaceholder")),s(4),k(" ",v(18,16,"common.cancel")," "),s(2),_("disabled",!e.newListName().trim()||e.creatingList()),s(),B(e.creatingList()?20:21)}}function Jt(n,C){n&1&&(f(0,"hlm-spinner",3),y(1),b(2,"transloco")),n&2&&(s(),k(" ",v(2,1,"common.updating")," "))}function ei(n,C){n&1&&(y(0),b(1,"transloco")),n&2&&k(" ",v(1,1,"common.save")," ")}function ti(n,C){if(n&1){let e=M();a(0,"hlm-dialog-content",16)(1,"hlm-dialog-header")(2,"h3",17),y(3),b(4,"transloco"),l(),a(5,"p",18),y(6),b(7,"transloco"),l()(),a(8,"div",19)(9,"div",20)(10,"label",25),y(11),b(12,"transloco"),l(),a(13,"input",26),b(14,"transloco"),X("ngModelChange",function(i){g(e);let o=u();return j(o.editListName,i)||(o.editListName=i),h(i)}),d("keydown.enter",function(){g(e);let i=u();return h(i.updateList())}),l()()(),a(15,"hlm-dialog-footer")(16,"button",23),d("click",function(){g(e);let i=u();return h(i.closeEditDialog())}),y(17),b(18,"transloco"),l(),a(19,"button",24),d("click",function(){g(e);let i=u();return h(i.updateList())}),N(20,Jt,3,3)(21,ei,2,3),l()()()}if(n&2){let e=u();s(3),W(v(4,8,"shoppingList.editList")),s(3),W(v(7,10,"shoppingList.editListDescription")),s(5),W(v(12,12,"shoppingList.listName")),s(2),$("ngModel",e.editListName),_("placeholder",v(14,14,"shoppingList.listNamePlaceholder")),s(4),k(" ",v(18,16,"common.cancel")," "),s(2),_("disabled",!e.editListName().trim()||e.updatingList()),s(),B(e.updatingList()?20:21)}}var Pt=(()=>{class n{listManager=T(Ie);lists=c(()=>this.listManager.lists.value()??[]);selectedListId=this.listManager.selectedListId;loading=c(()=>this.listManager.lists.isLoading()||this.listManager.loading());createDialog=Me.required(J);editDialog=Me.required("editDialog");newListName=p("");creatingList=p(!1);editingList=p(null);editListName=p("");updatingList=p(!1);onTabChange(e){this.listManager.selectedListId.set(e)}openCreateDialog(){this.newListName.set(""),this.createDialog().open()}closeDialog(){this.createDialog().close(),this.newListName.set("")}createList(){let e=this.newListName().trim();if(e){this.creatingList.set(!0);try{this.listManager.createList(e),this.closeDialog()}finally{this.creatingList.set(!1)}}}openEditDialog(e,t){e.stopPropagation(),this.editingList.set(t),this.editListName.set(t.name),this.editDialog().open()}closeEditDialog(){this.editDialog().close(),this.editingList.set(null),this.editListName.set("")}updateList(){let e=this.editingList(),t=this.editListName().trim();if(!(!e||!t)){this.updatingList.set(!0);try{this.listManager.updateList(e.id,t),this.closeEditDialog()}finally{this.updatingList.set(!1)}}}deleteList(e,t){e.stopPropagation(),confirm("Are you sure you want to delete this list?")&&this.listManager.deleteList(t)}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=V({type:n,selectors:[["lib-shopping-list-tabs"]],viewQuery:function(t,i){t&1&&Xe(i.createDialog,J,5)(i.editDialog,Xt,5),t&2&&le(2)},features:[z([R({lucidePlus:be,lucideX:rt,lucidePencil:et,lucideTrash:ve})])],decls:17,vars:5,consts:[["createDialog",""],["editDialog",""],[1,"flex","items-center","gap-2","min-w-0"],["size","small"],[1,"flex-1","min-w-0","overflow-hidden",3,"tab"],[1,"w-full","border-b","overflow-x-auto","overflow-y-hidden","scrollbar-hide"],[1,"flex","items-center","gap-1","flex-shrink-0","group"],["hlmBtn","","size","icon","variant","ghost",1,"flex-shrink-0",3,"click"],["hlm","","name","lucidePlus","size","sm"],["closeDelay","100",3,"closed"],["hlm",""],["class","sm:max-w-[425px]",4,"brnDialogContent"],[1,"whitespace-nowrap",3,"click","hlmTabsTrigger"],["hlmBtn","","size","icon-xs","variant","ghost",3,"click"],["hlm","","size","xs","name","lucidePencil"],["hlm","","size","xs","name","lucideTrash"],[1,"sm:max-w-[425px]"],["hlmDialogTitle",""],["hlmDialogDescription",""],[1,"grid","gap-4","py-4"],[1,"grid","gap-2"],["hlmLabel","","for","listName"],["hlmInput","","id","listName",3,"ngModelChange","keydown.enter","ngModel","placeholder"],["hlmBtn","","variant","outline",3,"click"],["hlmBtn","",3,"click","disabled"],["hlmLabel","","for","editListName"],["hlmInput","","id","editListName",3,"ngModelChange","keydown.enter","ngModel","placeholder"]],template:function(t,i){if(t&1){let o=M();a(0,"div",2),N(1,Qt,1,0,"hlm-spinner",3),a(2,"hlm-tabs",4)(3,"hlm-tabs-list",5),re(4,Kt,9,8,"div",6,Ut),l()(),a(6,"button",7),b(7,"transloco"),d("click",function(){return g(o),h(i.openCreateDialog())}),f(8,"ng-icon",8),l()(),a(9,"brn-dialog",9,0),d("closed",function(){return g(o),h(i.closeDialog())}),f(11,"brn-dialog-overlay",10),xe(12,Gt,22,18,"hlm-dialog-content",11),l(),a(13,"brn-dialog",9,1),d("closed",function(){return g(o),h(i.closeEditDialog())}),f(15,"brn-dialog-overlay",10),xe(16,ti,22,18,"hlm-dialog-content",11),l()}t&2&&(s(),B(i.loading()?1:-1),s(),_("tab",i.selectedListId()??""),s(2),se(i.lists()),s(2),I("aria-label",v(7,3,"shoppingList.createList")))},dependencies:[Q,Y,he,fe,_e,Fe,Ve,Ae,K,H,O,J,lt,at,dt,ct,mt,pt,ut,Ce,gt,Te,ue,pe],encapsulation:2,changeDetection:0})}return n})();var ii=(n,C)=>C.id;function ni(n,C){n&1&&(a(0,"div",4),f(1,"hlm-spinner",14),l())}function oi(n,C){if(n&1&&f(0,"lib-shopping-list-item-card",13),n&2){let e=C.$implicit;_("item",e)}}var Et=(()=>{class n{service=T(Le);listManager=T(Ie);newItemName=p("");items=c(()=>this.service.items.value()??[]);loading=c(()=>this.service.items.isLoading()||this.service.loading());sortedItems=c(()=>{let e=this.items()??[],t=e.filter(r=>r.active),i=e.filter(r=>!r.active),o=(r,ee)=>{if(r.is_favored!==ee.is_favored)return r.is_favored?-1:1;let te=r.active_changed?new Date(r.active_changed).getTime():0;return(ee.active_changed?new Date(ee.active_changed).getTime():0)-te};return t.sort(o),i.sort(o),[...t,...i]});filteredOptions=c(()=>(this.items()??[]).filter(t=>!t.active&&t.product_name.toLowerCase().includes(this.newItemName().toLowerCase())));constructor(){S(()=>{let e=this.listManager.selectedListId();this.service.setCurrentList(e)})}handleSearch(e){let t=this.items().find(i=>i.product_name===e);!t||t.active||(this.service.toggleItem(t.id,!0).subscribe(),this.clearAutocomplete())}clearAutocomplete(){this.newItemName.set("")}focusAddInput(){try{document.getElementById("add-input")?.focus()}catch{}}addItem(){let e=this.newItemName();e&&this.service.addItem(e,void 0).subscribe({next:()=>{this.clearAutocomplete()},error:t=>{console.error("Add item error:",t)}})}refreshList(){this.service.items.reload()}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=V({type:n,selectors:[["lib-sl-dashboard"]],features:[z([R({lucideShoppingCart:nt,lucidePlus:be,lucideRefreshCcw:tt}),yt({transformOptionToString:e=>e.product_name,transformOptionToValue:e=>e.product_name})])],decls:17,vars:8,consts:[[1,"flex","flex-col","gap-4"],[1,"px-4"],[1,"flex-1","flex","flex-col","gap-4","overflow-hidden","py-4"],[1,"flex","sm:flex-row","gap-2","items-stretch","sm:items-center","relative","px-4",3,"ngSubmit"],[1,"absolute","inset-0","bg-background/50","flex","justify-center","items-center","z-10","rounded-lg"],[3,"searchChange","valueChange","keydown.enter","searchPlaceholderText","filteredOptions","search","autocompleteEmptyClass"],["hlmBtn","","size","icon","variant","default","type","submit"],["hlm","","name","lucidePlus","size","sm"],[3,"orientation"],["hlmBtn","","size","icon","variant","default","type","button",3,"click"],["hlm","","name","lucideRefreshCcw","size","sm"],[1,"flex-1","overflow-auto"],[1,"grid","grid-cols-1","sm:grid-cols-2","lg:grid-cols-3","xl:grid-cols-4","gap-4","px-4"],[3,"item"],["size","large"]],template:function(t,i){t&1&&(a(0,"div",0)(1,"div",1),f(2,"lib-shopping-list-tabs"),l(),a(3,"div",2)(4,"form",3),d("ngSubmit",function(){return i.addItem()}),N(5,ni,2,0,"div",4),a(6,"hlm-autocomplete",5),b(7,"transloco"),X("searchChange",function(r){return j(i.newItemName,r)||(i.newItemName=r),r}),d("valueChange",function(r){return i.handleSearch(r)})("keydown.enter",function(){return i.addItem()}),l(),a(8,"button",6),f(9,"ng-icon",7),l(),f(10,"hlm-separator",8),a(11,"button",9),d("click",function(){return i.refreshList()}),f(12,"ng-icon",10),l()(),a(13,"section",11)(14,"div",12),re(15,oi,1,1,"lib-shopping-list-item-card",13,ii),l()()()()),t&2&&(s(5),B(i.loading()?5:-1),s(),_("searchPlaceholderText",v(7,6,"shoppingList.searchPlaceholder"))("filteredOptions",i.filteredOptions()),$("search",i.newItemName),_("autocompleteEmptyClass","hidden"),s(4),_("orientation","vertical"),s(5),se(i.sortedItems()))},dependencies:[Q,Y,Je,Ze,Ge,K,H,O,Te,Lt,St,Pt,ue,Tt,pe],encapsulation:2,changeDetection:0})}return n})();var Cr=[{path:Pe(ke.app.shoppingList._.root._),component:Et},{path:"**",redirectTo:Pe(ke.app.shoppingList._.root._)}];export{Dt as ShoppingBasketToggleComponent,Le as ShoppingListService,Cr as shoppingListRoutes};
