import{e as Ct,f as Tt}from"./chunk-VADULWA5.js";import{$ as z,$a as b,$d as ht,A as ne,Ad as ee,Ba as $e,Ca as Ie,Cd as st,Da as ae,E as C,Ec as Je,Ed as rt,F as g,Fc as fe,G as h,Ga as xe,Ia as I,Ja as y,Jb as ce,Jc as et,Jd as V,Ka as $,Kb as me,Kd as at,L as p,La as k,Ld as lt,Mb as P,Md as dt,Na as j,Nb as pe,Nc as tt,Nd as ct,O as G,Oa as Q,Oc as it,Od as mt,Pa as X,Pb as Y,R as a,Rb as ue,Rc as _e,Sd as be,Ta as je,Tc as nt,Ua as R,Ub as ge,Ud as pt,Vb as Ye,Vd as ut,Wa as Qe,Wd as ve,X as A,Xb as Ze,Xd as gt,Z as L,Zb as he,_a as _,_b as Ge,_d as Me,aa as we,be as Ce,cb as Xe,db as d,dc as Z,eb as N,ee as ft,fa as S,fc as O,fe as _t,g as B,ga as E,gb as le,gc as q,ge as bt,h as D,ha as H,hb as J,ib as c,ie as vt,jb as Se,k as qe,ka as oe,la as se,lb as Ue,le as ke,ma as T,mb as U,na as s,nd as ot,o as F,oa as l,p as We,pa as f,pb as de,r as w,sb as Ke,u as W,ua as M,ub as K,va as re,wa as m,x as ie,ya as u}from"./chunk-YS2LDEDF.js";import{a as te,b as ze,c as Re,d as Oe}from"./chunk-X37JSKTG.js";var yt=(()=>{class n{static _uniqueId=0;id=c(`brn-toggle-${++n._uniqueId}`);value=c();disabled=c(!1,{transform:de});state=U("off");type=c("button");ariaLabel=c(null,{alias:"aria-label"});_isOn=d(()=>this.state()==="on");toggle(){this.disabled()||this.state.set(this._isOn()?"off":"on")}static \u0275fac=function(t){return new(t||n)};static \u0275dir=L({type:n,selectors:[["button","brnToggle",""]],hostVars:7,hostBindings:function(t,i){t&1&&m("click",function(){return i.toggle()}),t&2&&(re("id",i.id())("type",i.type()),S("disabled",i.disabled()?!0:null)("data-disabled",i.disabled()?!0:null)("data-state",i.state())("aria-pressed",i._isOn())("aria-label",i.ariaLabel()||null))},inputs:{id:[1,"id"],value:[1,"value"],disabled:[1,"disabled"],state:[1,"state"],type:[1,"type"],ariaLabel:[1,"aria-label","ariaLabel"]},outputs:{state:"stateChange"}})}return n})();var Pt=pe('hover:bg-muted hover:text-muted-foreground focus-visible:border-ring data-[state=on]:bg-accent data-[state=on]:text-accent-foreground focus-visible:ring-ring/50 inline-flex items-center justify-center gap-2 rounded-md text-sm font-medium whitespace-nowrap transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:pointer-events-none disabled:opacity-50 [&_ng-icon]:pointer-events-none [&_ng-icon]:shrink-0 [&_ng-icon:not([class*="text-"])]:text-base',{variants:{variant:{default:"bg-transparent",outline:"border-input hover:bg-accent hover:text-accent-foreground border bg-transparent shadow-xs"},size:{default:"h-9 min-w-9 px-2",sm:"h-8 min-w-8 px-1.5",lg:"h-10 min-w-10 px-2.5"}},defaultVariants:{variant:"default",size:"default"}}),Ne=(()=>{class n{variant=c("default");size=c("default");userClass=c("",{alias:"class"});_computedClass=d(()=>P(Pt({variant:this.variant(),size:this.size()}),this.userClass()));static \u0275fac=function(t){return new(t||n)};static \u0275dir=L({type:n,selectors:[["button","hlmToggle",""]],hostAttrs:["data-slot","toggle"],hostVars:2,hostBindings:function(t,i){t&2&&I(i._computedClass())},inputs:{variant:[1,"variant"],size:[1,"size"],userClass:[1,"class","userClass"]},features:[z([{directive:yt,inputs:["id","id","value","value","disabled","disabled","state","state","aria-label","aria-label","type","type"],outputs:["stateChange","stateChange"]}])]})}return n})();var Dt=(()=>{class n{variant=c("default");size=c("default");disabled=c(!1);state=U("off");isAnimating=p(!1);animationDirection=p("");constructor(){N(()=>{let e=this.state();this.animationDirection()===""&&e==="off"||(e==="on"?this.animationDirection.set("fill"):this.animationDirection.set("empty"),this.isAnimating.set(!0),setTimeout(()=>{this.isAnimating.set(!1)},800))})}animationClass=d(()=>{if(!this.isAnimating())return"";let e=this.animationDirection();return e==="fill"?"animate-bounce-shake":e==="empty"?"animate-empty":""});buttonClass=d(()=>{let e=this.state(),t=this.animationClass(),i="";return e==="on"?i="bg-green-100 hover:bg-green-200 dark:bg-green-900/30 dark:hover:bg-green-900/50 border-green-300 dark:border-green-700":i="bg-muted/50 hover:bg-muted dark:bg-muted/20 dark:hover:bg-muted/40 border-muted-foreground/20",`${t} ${i}`});iconClass=d(()=>{let e=this.state(),t=this.isAnimating();if(e==="on"){let i="text-green-600 dark:text-green-400";return t&&this.animationDirection()==="fill"?`${i} animate-fill`:i}return"text-muted-foreground/60"});static \u0275fac=function(t){return new(t||n)};static \u0275cmp=A({type:n,selectors:[["gh-shopping-basket-toggle"]],inputs:{variant:[1,"variant"],size:[1,"size"],disabled:[1,"disabled"],state:[1,"state"]},outputs:{state:"stateChange"},features:[R([O({lucideShoppingBasket:tt})])],decls:2,vars:9,consts:[["hlmToggle","",1,"relative","overflow-hidden","transition-all","duration-300",3,"stateChange","variant","size","disabled","state"],["hlm","",1,"transition-all","duration-500",3,"name"]],template:function(t,i){t&1&&(s(0,"button",0),X("stateChange",function(r){return Q(i.state,r)||(i.state=r),r}),f(1,"ng-icon",1),l()),t&2&&(I(i.buttonClass()),T("variant",i.variant())("size",i.size())("disabled",i.disabled()),j("state",i.state),a(),I(i.iconClass()),T("name","lucideShoppingBasket"))},dependencies:[Ne,V,q],styles:["@keyframes _ngcontent-%COMP%_bounce-shake{0%,to{transform:translateY(0) rotate(0) scale(1)}10%{transform:translateY(-8px) rotate(-5deg) scale(1.1)}20%{transform:translateY(-8px) rotate(5deg) scale(1.1)}30%{transform:translateY(-8px) rotate(-5deg) scale(1.1)}40%{transform:translateY(0) rotate(0) scale(1)}50%{transform:scale(.95)}60%{transform:scale(1.05)}70%{transform:scale(.98)}80%{transform:scale(1.02)}90%{transform:scale(1)}}@keyframes _ngcontent-%COMP%_fill-basket{0%{opacity:1}50%{opacity:.6;filter:brightness(1.5)}to{opacity:1}}@keyframes _ngcontent-%COMP%_empty-basket{0%{transform:scale(1);opacity:1}30%{transform:scale(.8) rotate(-10deg);opacity:.7}60%{transform:scale(1.1) rotate(10deg);opacity:.8}to{transform:scale(1) rotate(0);opacity:1}}.animate-bounce-shake[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_bounce-shake .8s ease-in-out}.animate-fill[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fill-basket .5s ease-in-out}.animate-empty[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_empty-basket .6s ease-in-out}[_nghost-%COMP%]{display:inline-block}"],changeDetection:0})}return n})();var Te=(()=>{class n{supabase=C(Ce);authService=C(gt);currentListId=p(null);loadingCount=p(0);loading=d(()=>this.loadingCount()>0);items=le({params:()=>({listId:this.currentListId()}),loader:async({params:e})=>{if(!e.listId)return[];let{data:t,error:i}=await this.supabase.supabase.from("shopping_list_item").select("*").eq("list_id",e.listId).order("created_at",{ascending:!1});if(i)throw i;return t??[]}});count=d(()=>this.items.value()?.length??0);setCurrentList(e){this.currentListId.set(e)}addItem(e,t){let i=this.currentListId();if(!i)return D({error:new Error("No list selected")});let o=this.authService.user()?.id;return o?(this.loadingCount.update(r=>r+1),B(this.supabase.supabase.from("shopping_list_item").insert({product_name:e,additional_info:t,list_id:i,creator_id:o,active:!0,active_changed:new Date().toISOString()}).select().single()).pipe(F(r=>D({error:r})),w(()=>this.loadingCount.update(r=>r-1)),ie(r=>{if(r?.error)throw r.error;this.items.reload()}),W(r=>{if(r?.error)throw r.error;return D(r.data)}))):D({error:new Error("User not authenticated")})}updateItem(e,t){return this.loadingCount.update(i=>i+1),B(this.supabase.supabase.from("shopping_list_item").update(t).eq("id",e).select().single()).pipe(F(i=>D({error:i})),w(()=>this.loadingCount.update(i=>i-1)),ie(i=>{if(i?.error)throw i.error;this.items.reload()}),W(i=>{if(i?.error)throw i.error;return D(i.data)}))}deleteItem(e){return this.loadingCount.update(t=>t+1),B(this.supabase.supabase.from("shopping_list_item").delete().eq("id",e)).pipe(F(t=>D({error:t})),w(()=>this.loadingCount.update(t=>t-1)),ie(t=>{if(t?.error)throw t.error;this.items.reload()}),W(t=>{if(t?.error)throw t.error;return D(void 0)}))}toggleItem(e,t){return this.updateItem(e,{active:t,active_changed:new Date().toISOString()})}static \u0275fac=function(t){return new(t||n)};static \u0275prov=ne({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var Ht=n=>[n];function Vt(n,v){if(n&1){let e=M();s(0,"input",7),m("ngModelChange",function(i){g(e);let o=u();return h(o.editingName.set(i))})("blur",function(){g(e);let i=u();return h(i.saveInline())})("keydown.enter",function(i){g(e);let o=u();return i.preventDefault(),h(o.saveInline())})("keydown.escape",function(){g(e);let i=u();return h(i.cancelEdit())}),l()}if(n&2){let e=u();T("id",je("edit-",e.item().id))("ngModel",e.editingName())}}function Ft(n,v){if(n&1){let e=M();s(0,"div",5)(1,"h3",8),m("click",function(){g(e);let i=u();return h(i.startEdit())}),y(2),l()()}if(n&2){let e=u();a(),xe("text-destructive-foreground",e.isInDeleteMode()),a(),k(" ",e.item().product_name," ")}}function At(n,v){if(n&1){let e=M();s(0,"button",9),m("click",function(){g(e);let i=u();return h(i.confirmDelete())}),f(1,"ng-icon",10),l()}}function zt(n,v){if(n&1){let e=M();s(0,"gh-shopping-basket-toggle",11),m("stateChange",function(i){g(e);let o=u();return h(o.onBasketToggle(i))}),l(),s(1,"button",12),m("click",function(){g(e);let i=u();return h(i.confirmDelete())}),f(2,"ng-icon",10),l()}if(n&2){let e=u();T("state",e.item().active?"on":"off"),a(),T("ngClass",Qe(2,Ht,e.isTouchDevice()?"!hidden":"block"))}}var It=(()=>{class n{isTouchDevice=C(ht).isTouchDevice;service=C(Te);elementRef=C(G);item=c.required();itemUpdated=J();itemDeleted=J();busyCount=p(0);busy=d(()=>this.busyCount()>0);editingName=p(null);isEditing=d(()=>this.editingName()!==null);touchStartX=p(0);touchCurrentX=p(0);isInDeleteMode=p(!1);constructor(){N(()=>{if(this.isInDeleteMode()){let t=i=>{let o=i.target;this.elementRef.nativeElement.contains(o)||this.resetSwipe()};return setTimeout(()=>{document.addEventListener("click",t),document.addEventListener("touchstart",t)},0),()=>{document.removeEventListener("click",t),document.removeEventListener("touchstart",t)}}return()=>{}})}toggleItem(){let e=this.item();this.busyCount.update(t=>t+1),this.service.toggleItem(e.id,!e.active).pipe(w(()=>this.busyCount.update(t=>t-1))).subscribe({next:()=>this.itemUpdated.emit(),error:t=>console.error("Toggle error:",t)})}onBasketToggle(e){let t=this.item(),i=e==="on";t.active!==i&&(this.busyCount.update(o=>o+1),this.service.toggleItem(t.id,i).pipe(w(()=>this.busyCount.update(o=>o-1))).subscribe({next:()=>this.itemUpdated.emit(),error:o=>console.error("Toggle error:",o)}))}deleteItem(){let e=this.item();this.busyCount.update(t=>t+1),this.service.deleteItem(e.id).pipe(w(()=>this.busyCount.update(t=>t-1))).subscribe({next:()=>this.itemDeleted.emit(),error:t=>console.error("Delete error:",t)})}startEdit(){this.editingName.set(this.item().product_name??""),setTimeout(()=>{let e=document.getElementById("edit-"+this.item().id);e?.focus(),e?.select()},0)}saveInline(){let e=(this.editingName()||"").trim(),t=this.item();if(e===(t.product_name??"").trim()){this.cancelEdit();return}this.busyCount.update(i=>i+1),this.service.updateItem(t.id,{product_name:e}).pipe(w(()=>{this.busyCount.update(i=>i-1),this.cancelEdit()})).subscribe({next:()=>this.itemUpdated.emit(),error:i=>console.error("Update error:",i)})}cancelEdit(){this.editingName.set(null)}onTouchStart(e){this.touchStartX.set(e.touches[0].clientX),this.touchCurrentX.set(e.touches[0].clientX)}onTouchMove(e){this.touchCurrentX.set(e.touches[0].clientX)}onTouchEnd(){this.touchCurrentX()-this.touchStartX()<-50&&this.isInDeleteMode.set(!this.isInDeleteMode())}resetSwipe(){this.isInDeleteMode.set(!1)}confirmDelete(){this.deleteItem()}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=A({type:n,selectors:[["lib-shopping-list-item-card"]],inputs:{item:[1,"item"]},outputs:{itemUpdated:"itemUpdated",itemDeleted:"itemDeleted"},features:[R([O({lucideTrash:_e})])],decls:8,vars:8,consts:[["hlmCard","",1,"group","p-2","sm:p-3","relative","transition-colors","duration-300","ease-out",3,"touchstart","touchmove","touchend"],["hlmCardContent",""],[1,"flex","items-center","gap-3","w-full"],[1,"flex-1","min-w-0"],["hlmInput","",1,"w-full",3,"id","ngModel"],[1,"h-8","flex","items-center"],["hlmBtn","","variant","ghost","size","icon",1,"ml-auto","text-destructive-foreground","hover:text-destructive-foreground"],["hlmInput","",1,"w-full",3,"ngModelChange","blur","keydown.enter","keydown.escape","id","ngModel"],["hlmCardTitle","",1,"truncate","cursor-pointer","hover:text-primary",3,"click"],["hlmBtn","","variant","ghost","size","icon",1,"ml-auto","text-destructive-foreground","hover:text-destructive-foreground",3,"click"],["hlm","","name","lucideTrash","size","sm"],["size","sm","variant","outline",1,"ml-auto",3,"stateChange","state"],["hlmBtn","","variant","ghost","size","icon",3,"click","ngClass"]],template:function(t,i){t&1&&(s(0,"div",0),m("touchstart",function(r){return i.onTouchStart(r)})("touchmove",function(r){return i.onTouchMove(r)})("touchend",function(){return i.onTouchEnd()}),s(1,"div",1)(2,"div",2)(3,"div",3),E(4,Vt,1,3,"input",4)(5,Ft,3,3,"div",5),l(),E(6,At,2,0,"button",6)(7,zt,3,4),l()()()),t&2&&(xe("opacity-60",!i.item().active)("bg-destructive",i.isInDeleteMode())("text-destructive-foreground",i.isInDeleteMode()),a(4),H(i.isEditing()?4:5),a(2),H(i.isInDeleteMode()?6:7))},dependencies:[K,Ke,Z,ue,ge,he,ft,bt,_t,Y,be,V,q,Dt],encapsulation:2,changeDetection:0})}return n})();var De=(()=>{class n{orientation=c("horizontal");$orientation=this.orientation;direction=c("ltr");$direction=this.direction;activeTab=U(void 0,{alias:"brnTabs"});$activeTab=this.activeTab.asReadonly();activationMode=c("automatic");$activationMode=this.activationMode;tabActivated=J();_tabs=p({});$tabs=this._tabs.asReadonly();registerTrigger(e,t){this.updateEntry(e,{trigger:t})}registerContent(e,t){this.updateEntry(e,{content:t})}unregisterTrigger(e){this.updateEntry(e,{trigger:void 0}),this.activeTab()===e&&this.activeTab.set(void 0)}unregisterContent(e){this.updateEntry(e,{content:void 0})}updateEntry(e,t){this._tabs.update(i=>{let o=i[e]??{},r=te(te({},o),t);if(!r.trigger&&!r.content){let Ae=i,{[e]:ni}=Ae;return Oe(Ae,[Re(e)])}return ze(te({},i),{[e]:r})})}emitTabActivated(e){this.tabActivated.emit(e)}setActiveTab(e){this.activeTab.set(e)}static \u0275fac=function(t){return new(t||n)};static \u0275dir=L({type:n,selectors:[["","brnTabs",""]],hostVars:2,hostBindings:function(t,i){t&2&&S("data-orientation",i.orientation())("dir",i.direction())},inputs:{orientation:[1,"orientation"],direction:[1,"direction"],activeTab:[1,"brnTabs","activeTab"],activationMode:[1,"activationMode"]},outputs:{activeTab:"brnTabsChange",tabActivated:"tabActivated"},exportAs:["brnTabs"]})}return n})();var ye=(()=>{class n{elementRef=C(G);_root=C(De);_orientation=this._root.$orientation;triggerFor=c.required({alias:"brnTabsTrigger"});selected=d(()=>this._root.$activeTab()===this.triggerFor());_contentId=d(()=>`brn-tabs-content-${this.triggerFor()}`);_labelId=d(()=>`brn-tabs-label-${this.triggerFor()}`);_disabled=c(!1,{alias:"disabled",transform:de});get disabled(){return this._disabled()}constructor(){N(()=>{let e=this.triggerFor();Xe(()=>this._root.registerTrigger(e,this))})}focus(){this.elementRef.nativeElement.focus(),this._root.$activationMode()==="automatic"&&this.activate()}activate(){this.triggerFor()&&(this._root.setActiveTab(this.triggerFor()),this._root.emitTabActivated(this.triggerFor()))}get key(){return this.triggerFor()}ngOnDestroy(){this._root.unregisterTrigger(this.triggerFor())}static \u0275fac=function(t){return new(t||n)};static \u0275dir=L({type:n,selectors:[["button","brnTabsTrigger",""]],hostAttrs:["type","button","role","tab"],hostVars:9,hostBindings:function(t,i){t&1&&m("click",function(){return i.activate()}),t&2&&(re("id",i._labelId())("tabIndex",i._disabled()?-1:i.selected()?0:-1),S("aria-selected",i.selected())("aria-controls",i._contentId())("aria-disabled",i._disabled())("data-state",i.selected()?"active":"inactive")("data-orientation",i._orientation())("data-disabled",i._disabled()?"":void 0)("disabled",i._disabled()?"":void 0))},inputs:{triggerFor:[1,"brnTabsTrigger","triggerFor"],_disabled:[1,"disabled","_disabled"]},exportAs:["brnTabsTrigger"]})}return n})(),xt=(()=>{class n{_root=C(De);_orientation=this._root.$orientation;_direction=this._root.$direction;_activeTab=this._root.$activeTab;_tabs=this._root.$tabs;_elementRef=C(G);_keyDownListener=qe(this._elementRef.nativeElement,"keydown");_keyManager;triggers=Ue(ye,{descendants:!0});ngAfterContentInit(){this._keyManager=new ut(this.triggers()).withHorizontalOrientation(this._direction()).withHomeAndEnd().withPageUpDown().withWrap(),this._keyDownListener.pipe(We(1)).subscribe(()=>{let e=this._activeTab(),t=this._tabs(),i=0;if(e){let o=t[e];o&&(i=this.triggers().indexOf(o.trigger))}this._keyManager?.setActiveItem(i)}),this._keyDownListener.subscribe(e=>{"key"in e&&(this._orientation()==="horizontal"&&(e.key==="ArrowUp"||e.key==="ArrowDown")||this._orientation()==="vertical"&&(e.key==="ArrowLeft"||e.key==="ArrowRight"))||this._keyManager?.onKeydown(e)})}static \u0275fac=function(t){return new(t||n)};static \u0275dir=L({type:n,selectors:[["","brnTabsList",""]],contentQueries:function(t,i,o){t&1&&$e(o,i.triggers,ye,5),t&2&&ae()},hostAttrs:["role","tablist"],hostVars:2,hostBindings:function(t,i){t&2&&S("aria-orientation",i._orientation())("data-orientation",i._orientation())},exportAs:["brnTabsList"]})}return n})();var In=ot({passive:!0});var He=(()=>{class n{tab=c.required();userClass=c("",{alias:"class"});_computedClass=d(()=>P("flex flex-col gap-2",this.userClass()));static \u0275fac=function(t){return new(t||n)};static \u0275dir=L({type:n,selectors:[["","hlmTabs",""],["hlm-tabs"]],hostAttrs:["data-slot","tabs"],hostVars:2,hostBindings:function(t,i){t&2&&I(i._computedClass())},inputs:{tab:[1,"tab"],userClass:[1,"class","userClass"]},features:[z([{directive:De,inputs:["orientation","orientation","direction","direction","activationMode","activationMode","brnTabs","tab"],outputs:["tabActivated","tabActivated"]}])]})}return n})();var St=pe("bg-muted text-muted-foreground inline-flex h-9 w-fit items-center justify-center rounded-lg p-[3px]",{variants:{orientation:{horizontal:"h-10 space-x-1",vertical:"mt-2 h-fit flex-col space-y-1"}},defaultVariants:{orientation:"horizontal"}}),Ve=(()=>{class n{orientation=c("horizontal");userClass=c("",{alias:"class"});_computedClass=d(()=>P(St({orientation:this.orientation()}),this.userClass()));static \u0275fac=function(t){return new(t||n)};static \u0275dir=L({type:n,selectors:[["","hlmTabsList",""],["hlm-tabs-list"]],hostAttrs:["data-slot","tabs-list"],hostVars:2,hostBindings:function(t,i){t&2&&I(i._computedClass())},inputs:{orientation:[1,"orientation"],userClass:[1,"class","userClass"]},features:[z([xt])]})}return n})();var Fe=(()=>{class n{triggerFor=c.required({alias:"hlmTabsTrigger"});userClass=c("",{alias:"class"});_computedClass=d(()=>P("data-[state=active]:bg-background dark:data-[state=active]:text-foreground focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring dark:data-[state=active]:border-input dark:data-[state=active]:bg-input/30 text-foreground dark:text-muted-foreground inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-md border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:shadow-sm [&_ng-icon]:pointer-events-none [&_ng-icon]:shrink-0 [&_ng-icon:not([class*='text-'])]:text-base",this.userClass()));static \u0275fac=function(t){return new(t||n)};static \u0275dir=L({type:n,selectors:[["","hlmTabsTrigger",""]],hostAttrs:["data-slot","tabs-trigger"],hostVars:2,hostBindings:function(t,i){t&2&&I(i._computedClass())},inputs:{triggerFor:[1,"hlmTabsTrigger","triggerFor"],userClass:[1,"class","userClass"]},features:[z([{directive:ye,inputs:["brnTabsTrigger","hlmTabsTrigger","disabled","disabled"]}])]})}return n})();var Le=(()=>{class n{supabase=C(Ce);userId=p(null);loadingCount=p(0);loading=d(()=>this.loadingCount()>0);lists=le({params:()=>({userId:this.userId()}),loader:async({params:e})=>{if(!e.userId)return[];let{data:t,error:i}=await this.supabase.supabase.from("shopping_list").select("*").eq("creator_id",e.userId).order("created_at",{ascending:!0});if(i)throw i;return t??[]}});selectedListId=p(null);selectedList=d(()=>{let e=this.selectedListId();return(this.lists.value()??[]).find(i=>i.id===e)??null});constructor(){this.supabase.supabase.auth.getSession().then(({data:e})=>{let t=e?.session?.user??null;t&&this.userId.set(t.id)}).catch(()=>{}),this.supabase.supabase.auth.onAuthStateChange((e,t)=>{let i=t?.user?.id??null;this.userId.set(i),i||this.selectedListId.set(null)}),N(()=>{let e=this.lists.value();!this.selectedListId()&&e&&e.length>0&&this.selectedListId.set(e[0].id)})}createList(e){this.loadingCount.update(t=>t+1),B(this.supabase.supabase.auth.getUser()).pipe(W(t=>{let i=t?.data?.user?.id;return i?B(this.supabase.supabase.from("shopping_list").insert({name:e,creator_id:i}).select().single()):D({error:new Error("Not authenticated")})}),F(t=>D({error:t})),w(()=>this.loadingCount.update(t=>t-1))).subscribe(t=>{if(t?.error)throw t.error;this.lists.reload(),t?.data&&this.selectedListId.set(t.data.id)})}updateList(e,t){this.loadingCount.update(i=>i+1),B(this.supabase.supabase.from("shopping_list").update({name:t}).eq("id",e).select().single()).pipe(F(i=>D({error:i})),w(()=>this.loadingCount.update(i=>i-1))).subscribe(i=>{if(i?.error)throw i.error;this.lists.reload()})}deleteList(e){this.loadingCount.update(t=>t+1),B(this.supabase.supabase.from("shopping_list").delete().eq("id",e)).pipe(F(t=>D({error:t})),w(()=>this.loadingCount.update(t=>t-1))).subscribe(t=>{if(t?.error)throw t.error;this.selectedListId()===e&&this.selectedListId.set(null),this.lists.reload()})}static \u0275fac=function(t){return new(t||n)};static \u0275prov=ne({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var Wt=["editDialog"],$t=(n,v)=>v.id;function jt(n,v){n&1&&f(0,"hlm-spinner",3)}function Qt(n,v){if(n&1){let e=M();s(0,"div",6)(1,"button",12),m("click",function(){let i=g(e).$implicit,o=u();return h(o.onTabChange(i.id))}),y(2),s(3,"button",13),_(4,"transloco"),m("click",function(i){let o=g(e).$implicit,r=u();return h(r.openEditDialog(i,o))}),f(5,"ng-icon",14),l(),s(6,"button",13),_(7,"transloco"),m("click",function(i){let o=g(e).$implicit,r=u();return h(r.deleteList(i,o.id))}),f(8,"ng-icon",15),l()()()}if(n&2){let e=v.$implicit;a(),T("hlmTabsTrigger",e.id),a(),k(" ",e.name," "),a(),S("aria-label",b(4,4,"common.edit")),a(3),S("aria-label",b(7,6,"common.delete"))}}function Xt(n,v){n&1&&(f(0,"hlm-spinner",3),y(1),_(2,"transloco")),n&2&&(a(),k(" ",b(2,1,"common.creating")," "))}function Ut(n,v){n&1&&(y(0),_(1,"transloco")),n&2&&k(" ",b(1,1,"common.create")," ")}function Kt(n,v){if(n&1){let e=M();s(0,"hlm-dialog-content",16)(1,"hlm-dialog-header")(2,"h3",17),y(3),_(4,"transloco"),l(),s(5,"p",18),y(6),_(7,"transloco"),l()(),s(8,"div",19)(9,"div",20)(10,"label",21),y(11),_(12,"transloco"),l(),s(13,"input",22),_(14,"transloco"),X("ngModelChange",function(i){g(e);let o=u();return Q(o.newListName,i)||(o.newListName=i),h(i)}),m("keydown.enter",function(){g(e);let i=u();return h(i.createList())}),l()()(),s(15,"hlm-dialog-footer")(16,"button",23),m("click",function(){g(e);let i=u();return h(i.closeDialog())}),y(17),_(18,"transloco"),l(),s(19,"button",24),m("click",function(){g(e);let i=u();return h(i.createList())}),E(20,Xt,3,3)(21,Ut,2,3),l()()()}if(n&2){let e=u();a(3),$(b(4,8,"shoppingList.createList")),a(3),$(b(7,10,"shoppingList.createListDescription")),a(5),$(b(12,12,"shoppingList.listName")),a(2),j("ngModel",e.newListName),T("placeholder",b(14,14,"shoppingList.listNamePlaceholder")),a(4),k(" ",b(18,16,"common.cancel")," "),a(2),T("disabled",!e.newListName().trim()||e.creatingList()),a(),H(e.creatingList()?20:21)}}function Yt(n,v){n&1&&(f(0,"hlm-spinner",3),y(1),_(2,"transloco")),n&2&&(a(),k(" ",b(2,1,"common.updating")," "))}function Zt(n,v){n&1&&(y(0),_(1,"transloco")),n&2&&k(" ",b(1,1,"common.save")," ")}function Gt(n,v){if(n&1){let e=M();s(0,"hlm-dialog-content",16)(1,"hlm-dialog-header")(2,"h3",17),y(3),_(4,"transloco"),l(),s(5,"p",18),y(6),_(7,"transloco"),l()(),s(8,"div",19)(9,"div",20)(10,"label",25),y(11),_(12,"transloco"),l(),s(13,"input",26),_(14,"transloco"),X("ngModelChange",function(i){g(e);let o=u();return Q(o.editListName,i)||(o.editListName=i),h(i)}),m("keydown.enter",function(){g(e);let i=u();return h(i.updateList())}),l()()(),s(15,"hlm-dialog-footer")(16,"button",23),m("click",function(){g(e);let i=u();return h(i.closeEditDialog())}),y(17),_(18,"transloco"),l(),s(19,"button",24),m("click",function(){g(e);let i=u();return h(i.updateList())}),E(20,Yt,3,3)(21,Zt,2,3),l()()()}if(n&2){let e=u();a(3),$(b(4,8,"shoppingList.editList")),a(3),$(b(7,10,"shoppingList.editListDescription")),a(5),$(b(12,12,"shoppingList.listName")),a(2),j("ngModel",e.editListName),T("placeholder",b(14,14,"shoppingList.listNamePlaceholder")),a(4),k(" ",b(18,16,"common.cancel")," "),a(2),T("disabled",!e.editListName().trim()||e.updatingList()),a(),H(e.updatingList()?20:21)}}var Mt=(()=>{class n{listManager=C(Le);lists=d(()=>this.listManager.lists.value()??[]);selectedListId=this.listManager.selectedListId;loading=d(()=>this.listManager.lists.isLoading()||this.listManager.loading());createDialog=Se.required(ee);editDialog=Se.required("editDialog");newListName=p("");creatingList=p(!1);editingList=p(null);editListName=p("");updatingList=p(!1);onTabChange(e){this.listManager.selectedListId.set(e)}openCreateDialog(){this.newListName.set(""),this.createDialog().open()}closeDialog(){this.createDialog().close(),this.newListName.set("")}createList(){let e=this.newListName().trim();if(e){this.creatingList.set(!0);try{this.listManager.createList(e),this.closeDialog()}finally{this.creatingList.set(!1)}}}openEditDialog(e,t){e.stopPropagation(),this.editingList.set(t),this.editListName.set(t.name),this.editDialog().open()}closeEditDialog(){this.editDialog().close(),this.editingList.set(null),this.editListName.set("")}updateList(){let e=this.editingList(),t=this.editListName().trim();if(!(!e||!t)){this.updatingList.set(!0);try{this.listManager.updateList(e.id,t),this.closeEditDialog()}finally{this.updatingList.set(!1)}}}deleteList(e,t){e.stopPropagation(),confirm("Are you sure you want to delete this list?")&&this.listManager.deleteList(t)}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=A({type:n,selectors:[["lib-shopping-list-tabs"]],viewQuery:function(t,i){t&1&&(Ie(i.createDialog,ee,5),Ie(i.editDialog,Wt,5)),t&2&&ae(2)},features:[R([O({lucidePlus:fe,lucideX:nt,lucidePencil:Je,lucideTrash:_e})])],decls:17,vars:5,consts:[["createDialog",""],["editDialog",""],[1,"flex","items-center","gap-2","min-w-0"],["size","small"],[1,"flex-1","min-w-0","overflow-hidden",3,"tab"],[1,"w-full","border-b","overflow-x-auto","overflow-y-hidden","scrollbar-hide"],[1,"flex","items-center","gap-1","flex-shrink-0","group"],["hlmBtn","","size","icon","variant","ghost",1,"flex-shrink-0",3,"click"],["hlm","","name","lucidePlus","size","sm"],["closeDelay","100",3,"closed"],["hlm",""],["class","sm:max-w-[425px]",4,"brnDialogContent"],[1,"whitespace-nowrap",3,"click","hlmTabsTrigger"],["hlmBtn","","size","icon-xs","variant","ghost",3,"click"],["hlm","","size","xs","name","lucidePencil"],["hlm","","size","xs","name","lucideTrash"],[1,"sm:max-w-[425px]"],["hlmDialogTitle",""],["hlmDialogDescription",""],[1,"grid","gap-4","py-4"],[1,"grid","gap-2"],["hlmLabel","","for","listName"],["hlmInput","","id","listName",3,"ngModelChange","keydown.enter","ngModel","placeholder"],["hlmBtn","","variant","outline",3,"click"],["hlmBtn","",3,"click","disabled"],["hlmLabel","","for","editListName"],["hlmInput","","id","editListName",3,"ngModelChange","keydown.enter","ngModel","placeholder"]],template:function(t,i){if(t&1){let o=M();s(0,"div",2),E(1,jt,1,0,"hlm-spinner",3),s(2,"hlm-tabs",4)(3,"hlm-tabs-list",5),oe(4,Qt,9,8,"div",6,$t),l()(),s(6,"button",7),_(7,"transloco"),m("click",function(){return g(o),h(i.openCreateDialog())}),f(8,"ng-icon",8),l()(),s(9,"brn-dialog",9,0),m("closed",function(){return g(o),h(i.closeDialog())}),f(11,"brn-dialog-overlay",10),we(12,Kt,22,18,"hlm-dialog-content",11),l(),s(13,"brn-dialog",9,1),m("closed",function(){return g(o),h(i.closeEditDialog())}),f(15,"brn-dialog-overlay",10),we(16,Gt,22,18,"hlm-dialog-content",11),l()}t&2&&(a(),H(i.loading()?1:-1),a(),T("tab",i.selectedListId()??""),a(2),se(i.lists()),a(2),S("aria-label",b(7,3,"shoppingList.createList")))},dependencies:[K,Z,ue,ge,he,He,Ve,Fe,Y,V,q,ee,rt,st,at,lt,dt,ct,mt,be,pt,ve,me,ce],encapsulation:2,changeDetection:0})}return n})();var Jt=(n,v)=>v.id;function ei(n,v){n&1&&(s(0,"div",4),f(1,"hlm-spinner",14),l())}function ti(n,v){if(n&1&&f(0,"lib-shopping-list-item-card",13),n&2){let e=v.$implicit;T("item",e)}}var kt=(()=>{class n{service=C(Te);listManager=C(Le);newItemName=p("");items=d(()=>this.service.items.value()??[]);loading=d(()=>this.service.items.isLoading()||this.service.loading());sortedItems=d(()=>(this.items()??[]).slice().sort((t,i)=>{if(t.active===i.active){let o=t.active_changed?new Date(t.active_changed).getTime():0;return(i.active_changed?new Date(i.active_changed).getTime():0)-o}return t.active?-1:1}));filteredOptions=d(()=>(this.items()??[]).filter(t=>!t.active&&t.product_name.toLowerCase().includes(this.newItemName().toLowerCase())));constructor(){N(()=>{let e=this.listManager.selectedListId();this.service.setCurrentList(e)})}handleSearch(e){let t=this.items().find(i=>i.product_name===e);!t||t.active||(this.service.toggleItem(t.id,!0).subscribe(),this.clearAutocomplete())}clearAutocomplete(){this.newItemName.set("")}focusAddInput(){try{document.getElementById("add-input")?.focus()}catch{}}addItem(){let e=this.newItemName();e&&this.service.addItem(e,void 0).subscribe({next:()=>{this.clearAutocomplete()},error:t=>{console.error("Add item error:",t)}})}refreshList(){this.service.items.reload()}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=A({type:n,selectors:[["lib-sl-dashboard"]],features:[R([O({lucideShoppingCart:it,lucidePlus:fe,lucideRefreshCcw:et}),Ct({transformOptionToString:e=>e.product_name,transformOptionToValue:e=>e.product_name})])],decls:17,vars:8,consts:[[1,"flex","flex-col","gap-4"],[1,"px-4"],[1,"flex-1","flex","flex-col","gap-4","overflow-hidden","py-4"],[1,"flex","sm:flex-row","gap-2","items-stretch","sm:items-center","relative","px-4",3,"ngSubmit"],[1,"absolute","inset-0","bg-background/50","flex","justify-center","items-center","z-10","rounded-lg"],[3,"searchChange","valueChange","keydown.enter","searchPlaceholderText","filteredOptions","search","autocompleteEmptyClass"],["hlmBtn","","size","icon","variant","default","type","submit"],["hlm","","name","lucidePlus","size","sm"],[3,"orientation"],["hlmBtn","","size","icon","variant","default","type","button",3,"click"],["hlm","","name","lucideRefreshCcw","size","sm"],[1,"flex-1","overflow-auto"],[1,"grid","grid-cols-1","sm:grid-cols-2","lg:grid-cols-3","xl:grid-cols-4","gap-4","px-4"],[3,"item"],["size","large"]],template:function(t,i){t&1&&(s(0,"div",0)(1,"div",1),f(2,"lib-shopping-list-tabs"),l(),s(3,"div",2)(4,"form",3),m("ngSubmit",function(){return i.addItem()}),E(5,ei,2,0,"div",4),s(6,"hlm-autocomplete",5),_(7,"transloco"),X("searchChange",function(r){return Q(i.newItemName,r)||(i.newItemName=r),r}),m("valueChange",function(r){return i.handleSearch(r)})("keydown.enter",function(){return i.addItem()}),l(),s(8,"button",6),f(9,"ng-icon",7),l(),f(10,"hlm-separator",8),s(11,"button",9),m("click",function(){return i.refreshList()}),f(12,"ng-icon",10),l()(),s(13,"section",11)(14,"div",12),oe(15,ti,1,1,"lib-shopping-list-item-card",13,Jt),l()()()()),t&2&&(a(5),H(i.loading()?5:-1),a(),T("searchPlaceholderText",b(7,6,"shoppingList.searchPlaceholder"))("filteredOptions",i.filteredOptions()),j("search",i.newItemName),T("autocompleteEmptyClass","hidden"),a(4),T("orientation","vertical"),a(5),se(i.sortedItems()))},dependencies:[K,Z,Ge,Ye,Ze,Y,V,q,ve,Tt,It,Mt,me,vt,ce],encapsulation:2,changeDetection:0})}return n})();var bs=[{path:ke(Me.app.shoppingList._.root._),component:kt},{path:"**",redirectTo:ke(Me.app.shoppingList._.root._)}];export{Dt as ShoppingBasketToggleComponent,Te as ShoppingListService,bs as shoppingListRoutes};
